<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Docutils 0.19: https://docutils.sourceforge.io/" name="generator"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <meta content="ie=edge" http-equiv="x-ua-compatible"/>
  <meta content="Copy to clipboard" name="lang:clipboard.copy"/>
  <meta content="Copied to clipboard" name="lang:clipboard.copied"/>
  <meta content="en" name="lang:search.language"/>
  <meta content="True" name="lang:search.pipeline.stopwords"/>
  <meta content="True" name="lang:search.pipeline.trimmer"/>
  <meta content="No matching documents" name="lang:search.result.none"/>
  <meta content="1 matching document" name="lang:search.result.one"/>
  <meta content="# matching documents" name="lang:search.result.other"/>
  <meta content="[\s\-]+" name="lang:search.tokenizer"/>
  <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&amp;display=fallback" rel="stylesheet"/>
  <style>
   body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
  </style>
  <link href="../_static/stylesheets/application.css" rel="stylesheet"/>
  <link href="../_static/stylesheets/application-palette.css" rel="stylesheet"/>
  <link href="../_static/stylesheets/application-fixes.css" rel="stylesheet"/>
  <link href="../_static/fonts/material-icons.css" rel="stylesheet"/>
  <meta content="#262626" name="theme-color"/>
  <script src="../_static/javascripts/modernizr.js">
  </script>
  <link href="../_static/images/flux-operator.jpg" rel="apple-touch-icon"/>
  <title>
   Designs — Flux Operator
  </title>
  <link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../_static/material.css" rel="stylesheet" type="text/css"/>
  <link href="../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../_static/css/rtd_sphinx_search.min.css" rel="stylesheet" type="text/css"/>
  <link href="../_static/custom.css" rel="stylesheet" type="text/css"/>
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js">
  </script>
  <script src="../_static/jquery.js">
  </script>
  <script src="../_static/underscore.js">
  </script>
  <script src="../_static/_sphinx_javascript_frameworks_compat.js">
  </script>
  <script src="../_static/doctools.js">
  </script>
  <script src="../_static/sphinx_highlight.js">
  </script>
  <script src="../_static/clipboard.min.js">
  </script>
  <script src="../_static/copybutton.js">
  </script>
  <script src="../_static/js/rtd_sphinx_search.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js">
  </script>
  <link href="../_static/favicon.ico" rel="shortcut icon"/>
  <link href="../genindex.html" rel="index" title="Index"/>
  <link href="../search.html" rel="search" title="Search"/>
  <link href="../contributing.html" rel="next" title="Contributing"/>
  <link href="creation.html" rel="prev" title="Operator Creation"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
  <!-- Social: Facebook / Open Graph -->
  <title>
   Flux RESTful API in Python
  </title>
  <link href="https://flux-framework.github.io/flux-restful-api/" rel="canonical"/>
  <meta content="website" property="og:type"/>
  <meta content="https://flux-framework.github.io/flux-restful-api/" property="og:url"/>
  <meta content="Flux RESTful API" property="og:title"/>
  <meta content="https://raw.githubusercontent.com/flux-framework/flux-restful-api/main/docs/images/logo.png" property="og:image"/>
  <meta content="Flux RESTful API in Python" property="og:description"/>
  <meta content="Flux RESTful API" property="og:site_name"/>
  <meta content="en_US" property="og:locale"/>
  <!-- Social: Twitter -->
  <meta content="summary" name="twitter:card"/>
  <meta content="@FluxFramework" name="twitter:site"/>
  <meta content="Flux Framework" name="twitter:title"/>
  <meta content="Flux RESTFul API in Python" name="twitter:description"/>
  <meta content="https://raw.githubusercontent.com/flux-framework/flux-restful-api/main/docs/images/logo.png" name="twitter:image"/>
  <!-- Social: Google+ / Schema.org  -->
  <meta content="Flux RESTful API" itemprop="name"/>
  <meta content="Flux RESTFul API in Python" itemprop="description"/>
  <meta content="https://raw.githubusercontent.com/flux-framework/flux-restful-api/main/docs/images/logo.png" itemprop="image"/>
  <script type="application/ld+json">
   {"@type":"WebSite","headline":"Flux RESTful API","url":"https://flux-framework.github.io/flux-restful-api","description":"Flux RESTful API in Python","name":"Flux RESTful API","@context":"https://schema.org"}
  </script>
  <style>
   .material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 48
}
.sphx-glr-script-out .highlight pre {
  background-color: #def0ff !important;
}
  </style>
  <link href="../_static/images/flux-operator.jpg" rel="apple-touch-icon"/>
 </head>
 <body data-md-color-accent="blue" data-md-color-primary="blue" dir="ltr">
  <svg class="md-svg">
   <defs data-children-count="0">
    <svg height="448" id="__github" viewbox="0 0 416 448" width="416" xmlns="http://www.w3.org/2000/svg">
     <path d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z" fill="currentColor">
     </path>
    </svg>
   </defs>
  </svg>
  <input class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
  <input class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
  <label class="md-overlay" data-md-component="overlay" for="__drawer">
  </label>
  <a class="md-skip" href="#development/designs" tabindex="1">
   Skip to content
  </a>
  <header class="md-header" data-md-component="header">
   <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
     <div class="md-flex__cell md-flex__cell--shrink">
      <a class="md-header-nav__button md-logo" href="../index.html" title="Flux Operator">
       <span class="material-symbols-outlined">
        cycle
       </span>
      </a>
     </div>
     <div class="md-flex__cell md-flex__cell--shrink">
      <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer">
      </label>
     </div>
     <div class="md-flex__cell md-flex__cell--stretch">
      <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
       <span class="md-header-nav__topic" style="width: 1046px;margin-left: -20px;">
        Flux Operator
       </span>
       <span class="md-header-nav__topic">
        Designs
       </span>
      </div>
     </div>
     <div class="md-flex__cell md-flex__cell--shrink">
      <label class="md-icon md-icon--search md-header-nav__button" for="__search">
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
       <label class="md-search__overlay" for="__search">
       </label>
       <div class="md-search__inner" role="search">
        <form action="../search.html" class="md-search__form" method="get" name="search">
         <input autocapitalize="off" autocomplete="off" class="md-search__input" data-md-component="query" data-md-state="active" name="q" placeholder="Search" spellcheck="false" type="text"/>
         <label class="md-icon md-search__icon" for="__search">
         </label>
         <button class="md-icon md-search__icon" data-md-component="reset" tabindex="-1" type="reset">
          
         </button>
        </form>
        <div class="md-search__output">
         <div class="md-search__scrollwrap" data-md-scrollfix="">
          <div class="md-search-result" data-md-component="result">
           <div class="md-search-result__meta">
            Type to start searching
           </div>
           <ol class="md-search-result__list">
           </ol>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <div class="md-flex__cell md-flex__cell--shrink">
      <div class="md-header-nav__source">
       <a class="md-source" data-md-source="github" href="https://github.com/flux-framework/flux-operator/" title="Go to repository">
        <div class="md-source__icon">
         <!--<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>-->
         <!-- updated to match riverml.xml site-->
         <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
          <path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z" fill="#ffffff">
          </path>
         </svg>
        </div>
        <div class="md-source__repository">
         Flux Operator
        </div>
       </a>
      </div>
     </div>
    </div>
   </nav>
  </header>
  <div class="md-container">
   <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
     <ul class="md-tabs__list">
      <li class="md-tabs__item">
       <a class="md-tabs__link" href="https://flux-framework.org/">
        Flux Framework
       </a>
      </li>
      <li class="md-tabs__item">
       <a class="md-tabs__link" href="https://github.com/flux-framework">
        Flux Framework on GitHub
       </a>
      </li>
      <li class="md-tabs__item">
       <a class="md-tabs__link" href="https://github.com/flux-framework/flux-operator">
        Flux Operator on GitHub
       </a>
      </li>
      <li class="md-tabs__item">
       <a class="md-tabs__link" href="index.html">
        Development
       </a>
      </li>
     </ul>
    </div>
   </nav>
   <main class="md-main">
    <div class="md-main__inner md-grid" data-md-component="container">
     <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
      <div class="md-sidebar__scrollwrap">
       <div class="md-sidebar__inner">
        <nav class="md-nav md-nav--primary" data-md-level="0">
         <label class="md-nav__title md-nav__title--site" for="__drawer">
          <a class="md-nav__button md-logo" href="../index.html" title="Flux Operator">
           <i class="md-icon">
            cycle
           </i>
          </a>
          <a href="../index.html" title="Flux Operator">
           Flux Operator
          </a>
         </label>
         <div class="md-nav__source">
          <a class="md-source" data-md-source="github" href="https://github.com/flux-framework/flux-operator/" title="Go to repository">
           <div class="md-source__icon">
            <!--<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>-->
            <!-- updated to match riverml.xml site-->
            <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
             <path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z" fill="#ffffff">
             </path>
            </svg>
           </div>
           <div class="md-source__repository">
            Flux Operator
           </div>
          </a>
         </div>
         <ul class="md-nav__list">
          <li class="md-nav__item">
           <span class="md-nav__link caption">
            <span class="caption-text">
             Getting Started
            </span>
           </span>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../getting_started/index.html">
            User Guide
           </a>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="index.html">
            Development
           </a>
           <ul class="md-nav__list">
            <li class="md-nav__item">
             <a class="md-nav__link" href="developer-guide.html">
              Developer Guide
             </a>
            </li>
            <li class="md-nav__item">
             <a class="md-nav__link" href="aws.html">
              Flux Operator on EKS
             </a>
            </li>
            <li class="md-nav__item">
             <a class="md-nav__link" href="creation.html">
              Operator Creation
             </a>
            </li>
            <li class="md-nav__item">
             <input class="md-toggle md-nav__toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
             <label class="md-nav__link md-nav__link--active" for="__toc">
              Designs
             </label>
             <a class="md-nav__link md-nav__link--active" href="#">
              Designs
             </a>
             <nav class="md-nav md-nav--secondary">
              <label class="md-nav__title" for="__toc">
               Contents
              </label>
              <ul class="md-nav__list" data-md-scrollfix="">
               <li class="md-nav__item">
                <a class="md-nav__link" href="#development-designs--page-root">
                 Designs
                </a>
                <nav class="md-nav">
                 <ul class="md-nav__list">
                  <li class="md-nav__item">
                   <a class="md-nav__link" href="#active-design">
                    Active Design
                   </a>
                  </li>
                  <li class="md-nav__item">
                   <a class="md-nav__link" href="#early-designs">
                    Early Designs
                   </a>
                   <nav class="md-nav">
                    <ul class="md-nav__list">
                     <li class="md-nav__item">
                      <a class="md-nav__link" href="#design-3">
                       Design 3
                      </a>
                     </li>
                     <li class="md-nav__item">
                      <a class="md-nav__link" href="#design-2-2">
                       Design 2.2
                      </a>
                     </li>
                     <li class="md-nav__item">
                      <a class="md-nav__link" href="#design-2-1">
                       Design 2.1
                      </a>
                     </li>
                     <li class="md-nav__item">
                      <a class="md-nav__link" href="#design-1">
                       Design 1
                      </a>
                     </li>
                    </ul>
                   </nav>
                  </li>
                  <li class="md-nav__item">
                   <a class="md-nav__link" href="#wisdom">
                    Wisdom
                   </a>
                   <nav class="md-nav">
                    <ul class="md-nav__list">
                     <li class="md-nav__item">
                      <a class="md-nav__link" href="#learned-knowledge">
                       Learned Knowledge
                      </a>
                     </li>
                     <li class="md-nav__item">
                      <a class="md-nav__link" href="#what-is-a-workspace">
                       What is a workspace?
                      </a>
                     </li>
                    </ul>
                   </nav>
                  </li>
                 </ul>
                </nav>
               </li>
               <li class="md-nav__item">
                <a class="md-nav__extra_link" href="../_sources/development/designs.md.txt">
                 Show Source
                </a>
               </li>
              </ul>
             </nav>
            </li>
           </ul>
          </li>
          <li class="md-nav__item">
           <span class="md-nav__link caption">
            <span class="caption-text">
             About
            </span>
           </span>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../contributing.html">
            Contributing
           </a>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../about/license.html">
            License
           </a>
          </li>
         </ul>
        </nav>
       </div>
      </div>
     </div>
     <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
      <div class="md-sidebar__scrollwrap">
       <div class="md-sidebar__inner">
        <nav class="md-nav md-nav--secondary">
         <label class="md-nav__title" for="__toc">
          Contents
         </label>
         <ul class="md-nav__list" data-md-scrollfix="">
          <li class="md-nav__item">
           <a class="md-nav__link" href="#development-designs--page-root">
            Designs
           </a>
           <nav class="md-nav">
            <ul class="md-nav__list">
             <li class="md-nav__item">
              <a class="md-nav__link" href="#active-design">
               Active Design
              </a>
             </li>
             <li class="md-nav__item">
              <a class="md-nav__link" href="#early-designs">
               Early Designs
              </a>
              <nav class="md-nav">
               <ul class="md-nav__list">
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#design-3">
                  Design 3
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#design-2-2">
                  Design 2.2
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#design-2-1">
                  Design 2.1
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#design-1">
                  Design 1
                 </a>
                </li>
               </ul>
              </nav>
             </li>
             <li class="md-nav__item">
              <a class="md-nav__link" href="#wisdom">
               Wisdom
              </a>
              <nav class="md-nav">
               <ul class="md-nav__list">
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#learned-knowledge">
                  Learned Knowledge
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#what-is-a-workspace">
                  What is a workspace?
                 </a>
                </li>
               </ul>
              </nav>
             </li>
            </ul>
           </nav>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__extra_link" href="../_sources/development/designs.md.txt">
            Show Source
           </a>
          </li>
          <li class="md-nav__item" id="searchbox">
          </li>
         </ul>
        </nav>
       </div>
      </div>
     </div>
     <div class="md-content">
      <article class="md-content__inner md-typeset" role="main">
       <section id="designs">
        <h1 id="development-designs--page-root">
         Designs
         <a class="headerlink" href="#development-designs--page-root" title="Permalink to this heading">
          ¶
         </a>
        </h1>
        <section id="active-design">
         <h2 id="active-design">
          Active Design
          <a class="headerlink" href="#active-design" title="Permalink to this heading">
           ¶
          </a>
         </h2>
         <p>
          <img alt="09-16-2022/design-three-team.png" src="../_images/design-three-team1.png"/>
         </p>
         <ul class="simple">
          <li>
           <p>
            <a class="reference internal" href="09-16-2022/index.html">
             <span class="doc std std-doc">
              See the Design
             </span>
            </a>
           </p>
          </li>
          <li>
           <p>
            A
            <strong>
             MiniCluster
            </strong>
            is an
            <a class="reference external" href="https://kubernetes.io/docs/tasks/job/indexed-parallel-processing-static/">
             indexed job
            </a>
            so we can create N copies of the “same” base containers (each with Flux, and the connected workers in our cluster)
           </p>
          </li>
          <li>
           <p>
            The flux config is written to a volume at
            <code class="docutils literal notranslate">
             <span class="pre">
              /etc/flux/config
             </span>
            </code>
            (created via a config map) as a brokers.toml file.
           </p>
          </li>
          <li>
           <p>
            The startup script “wait.sh” handles writing the curve certificate (
            <code class="docutils literal notranslate">
             <span class="pre">
              /mnt/curve/curve.cert
             </span>
            </code>
            ) and generating and sharing a munge key in the same location.
           </p>
          </li>
          <li>
           <p>
            Networking of the pods works by way of exposing a service that includes the Pod subdomain. We add fully qualified domain names to the pods so that the
            <code class="docutils literal notranslate">
             <span class="pre">
              hostname
             </span>
            </code>
            command matches the full name, and Flux is given the full names in its broker.toml.
           </p>
          </li>
          <li>
           <p>
            The main pod either runs
            <code class="docutils literal notranslate">
             <span class="pre">
              flux
             </span>
             <span class="pre">
              start
             </span>
            </code>
            with a web service (creating a persistent “Mini Cluster” or
            <code class="docutils literal notranslate">
             <span class="pre">
              flux
             </span>
             <span class="pre">
              start
             </span>
            </code>
            with a specific command (if provided in the CRD) in which case the command runs, and the jobs finish and the cluster goes away.
           </p>
          </li>
         </ul>
        </section>
        <section id="early-designs">
         <h2 id="early-designs">
          Early Designs
          <a class="headerlink" href="#early-designs" title="Permalink to this heading">
           ¶
          </a>
         </h2>
         <p>
          It is often useful to think about many different designs, and iterate quickly before deciding on a direction
to take, and this is what we did in the first days of the Flux Operator.  The final design (at the top)
is what we decided to focus on, and the others are described (and illustrated) in detail at their respective
links. This is a review of various early designs we’ve thought about, presented in reverse order (newest to latest).
         </p>
         <section id="design-3">
          <h3 id="design-3">
           Design 3
           <a class="headerlink" href="#design-3" title="Permalink to this heading">
            ¶
           </a>
          </h3>
          <p>
           This design is a simple design based around a single custom resource definition
          </p>
          <ul class="simple">
           <li>
            <p>
             <a class="reference internal" href="09-07-2022/index.html">
              <span class="doc std std-doc">
               See the Design
              </span>
             </a>
            </p>
           </li>
          </ul>
         </section>
         <section id="design-2-2">
          <h3 id="design-2-2">
           Design 2.2
           <a class="headerlink" href="#design-2-2" title="Permalink to this heading">
            ¶
           </a>
          </h3>
          <p>
           This was a set of weekend work I embarked on because (primarily) I couldn’t get an internal CRD (the MiniCluster) working
and needed to keep this state elsewhere.
          </p>
          <ul class="simple">
           <li>
            <p>
             <a class="reference internal" href="09-05-2022/index.html">
              <span class="doc std std-doc">
               See the Design
              </span>
             </a>
            </p>
           </li>
          </ul>
         </section>
         <section id="design-2-1">
          <h3 id="design-2-1">
           Design 2.1
           <a class="headerlink" href="#design-2-1" title="Permalink to this heading">
            ¶
           </a>
          </h3>
          <p>
           This was the earliest design I came up with after talking to Eduardo!
          </p>
          <ul class="simple">
           <li>
            <p>
             <a class="reference internal" href="09-01-2022/index.html">
              <span class="doc std std-doc">
               See the Design
              </span>
             </a>
            </p>
           </li>
          </ul>
         </section>
         <section id="design-1">
          <h3 id="design-1">
           Design 1
           <a class="headerlink" href="#design-1" title="Permalink to this heading">
            ¶
           </a>
          </h3>
          <p>
           This is the original design spec’d out by Dan!
          </p>
          <ul class="simple">
           <li>
            <p>
             <a class="reference internal" href="08-31-2022/index.html">
              <span class="doc std std-doc">
               See the Design
              </span>
             </a>
            </p>
           </li>
          </ul>
         </section>
        </section>
        <section id="wisdom">
         <h2 id="wisdom">
          Wisdom
          <a class="headerlink" href="#wisdom" title="Permalink to this heading">
           ¶
          </a>
         </h2>
         <p>
          <strong>
           from the kubebuilder slack
          </strong>
         </p>
         <section id="learned-knowledge">
          <h3 id="learned-knowledge">
           Learned Knowledge
           <a class="headerlink" href="#learned-knowledge" title="Permalink to this heading">
            ¶
           </a>
          </h3>
          <ul class="simple">
           <li>
            <p>
             Reconciling should only take into account the spec of your object, and the real world.  Don’t use status to hold knowledge for future reconcile loops.  Use a workspace object instead.
            </p>
           </li>
           <li>
            <p>
             Status should only hold observations of the reconcile loop.  Conditions, perhaps a “Phase”, IDs of stuff you’ve found, etc.
            </p>
           </li>
           <li>
            <p>
             Use k8s ownership model to help with cleaning up things that should automatically be reclaimed when your object is deleted.
            </p>
           </li>
           <li>
            <p>
             Use finalizers to do manual clean-up-tasks
            </p>
           </li>
           <li>
            <p>
             Send events, but be very limited in how often you send events.  We’ve opted now to send events, essentially only when a Condition is modified (e.g. a Condition changes state or reason).
            </p>
           </li>
           <li>
            <p>
             Try not to do too many things in a single reconcile.  One thing is fine.  e.g. see one thing out of order?  Fix that and ask to be reconciled.  The next time you’ll see that it’s in order and you can check the next thing.  The resulting code is very robust and can handle almost any failure you throw at it.
            </p>
           </li>
           <li>
            <p>
             Add “kubebuilder:printcolums” markers to help kubectl-users get a nice summary when they do “kubectl get yourthing”.
            </p>
           </li>
           <li>
            <p>
             Accept and embrace that you will be reconciling an out-of-date object from time to time.  It shouldn’t really matter.  If it does, you might want to change things around so that it doesn’t matter.  Inconsistency is a fact of k8s life.
            </p>
           </li>
           <li>
            <p>
             Place extra care in taking errors and elevating them to useful conditions, and/or events.  These are the most visible part of an operator, and the go-to-place for humans when trying to figure out why your code doesn’t work.  If you’ve taken the time to extract the error text from the underlying system into an Event, your users will be able to fix the problem much quicker.
            </p>
           </li>
          </ul>
         </section>
         <section id="what-is-a-workspace">
          <h3 id="what-is-a-workspace">
           What is a workspace?
           <a class="headerlink" href="#what-is-a-workspace" title="Permalink to this heading">
            ¶
           </a>
          </h3>
          <p>
           A workspace object is when you need to record some piece of knowledge about a thing you’re doing, so that later you can use that when reconciling this object. MyObject “foo” is reconciled; so to record the thing you need to remember, create a MyObjectWorkspace — Owned by the MyObject, and with the same name + namespace.  MyObjectWorkspace doesn’t need a reconciler; it’s simply a tool for you to remember the thing. Next time you reconcile a MyObject, also read your MyObjectWorkspace so you can remember “what happened last time”. E.g. I’ve made a controller to create an EC2 instance, and we needed to be completely sure that we didn’t make the “launch instance” API call twice.  EC2 has a “post once only” technique whereby you specify a nonce to avoid duplicate API calls.  You would write the nonce to the workspace use the nonce to call the EC2 API write any status info of what you observed to the status. Rremove the nonce when you know that you’ve stored the results (e.g. instance IDs or whatever) When you reconcile, if the nonce is set, you can re-use it because it means that the EC2 call failed somehow.  EC2 uses the nonce the second time to recognise that “heh, this is the same request as before …” Stuff like this nonce shouldn’t go in your status. Put simply, the status should really never be used as input for your reconcile.
          </p>
          <p>
           Know that the scaffolded k8sClient includes a cache that automatically updates based on watches, and may give you out-of-date data (but this is fine because if it is out-of-date, there should be a reconcile in the queue already). Also know that there is a way to request objects bypassing a cache (look for APIReader).  This gives a read-only, but direct access to the API.  Useful for e.g. those workspace objects.
          </p>
         </section>
        </section>
       </section>
      </article>
     </div>
    </div>
   </main>
  </div>
  <footer class="md-footer">
   <div class="md-footer-nav">
    <nav class="md-footer-nav__inner md-grid">
     <a class="md-flex md-footer-nav__link md-footer-nav__link--prev" href="creation.html" rel="prev" title="Operator Creation">
      <div class="md-flex__cell md-flex__cell--shrink">
       <i class="md-icon md-icon--arrow-back md-footer-nav__button">
       </i>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
       <span class="md-flex__ellipsis">
        <span class="md-footer-nav__direction">
         Previous
        </span>
        Operator Creation
       </span>
      </div>
     </a>
     <a class="md-flex md-footer-nav__link md-footer-nav__link--next" href="../contributing.html" rel="next" title="Contributing">
      <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
       <span class="md-flex__ellipsis">
        <span class="md-footer-nav__direction">
         Next
        </span>
        Contributing
       </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
       <i class="md-icon md-icon--arrow-forward md-footer-nav__button">
       </i>
      </div>
     </a>
    </nav>
   </div>
   <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
     <div class="md-footer-copyright">
      <div class="md-footer-copyright__highlight">
       © Copyright 2022, Flux Developers.
      </div>
      Last updated on
              Dec 22, 2022.
      <br/>
      Created using
      <a href="http://www.sphinx-doc.org/">
       Sphinx
      </a>
      5.3.0.
             and
      <a href="https://github.com/bashtage/sphinx-material/">
       Material for
              Sphinx
      </a>
     </div>
    </div>
   </div>
  </footer>
  <script src="../_static/javascripts/application.js">
  </script>
  <script>
   app.initialize({version: "1.0.4", url: {base: ".."}})
  </script>
 </body>
</html>