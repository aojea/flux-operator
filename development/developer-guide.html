


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../_static/favicon.ico">
    
    
      
        <title>Developer Guide - Flux Operator</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../_static/sphinx_immaterial_theme.fa3fbbd75cfdd7cef.min.css" />
        <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
        <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
        <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

<!-- Social: Facebook / Open Graph -->
<title>Flux Operator </title>
<link rel="canonical" href="https://flux-framework.github.io/flux-operator/"/>
<meta property="og:type" content="website">

<meta property="og:url" content="https://flux-framework.github.io/flux-operator/">
<meta property="og:title" content="Flux Operator">
<meta property="og:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<meta property="og:description" content="Flux Operator ">
<meta property="og:site_name" content="Flux Operator">
<meta property="og:locale" content="en_US">

<!-- Social: Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@FluxFramework">
<meta name="twitter:title" content="Flux Framework">
<meta name="twitter:description" content="Flux Operator ">
<meta name="twitter:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">

<!-- Social: Google+ / Schema.org  -->
<meta itemprop="name" content="Flux Operator">
<meta itemprop="description" content="Flux Operator ">
<meta itemprop="image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<script type="application/ld+json">
  {"@type":"WebSite","headline":"Flux Operator","url":"https://flux-framework.github.io/flux-operator","description":"The Flux Operator creates Flux MiniClusters on Kubernetes ","name":"Flux Operator","@context":"https://schema.org"}
</script>

<style>
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 48
}
.sphx-glr-script-out .highlight pre {
  background-color: #def0ff !important;
}
  </style>




  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Flux Operator" class="md-header__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flux Operator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../getting_started/index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">Getting Started</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../deployment/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Deployment</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../about/index.html" class="md-tabs__link">
      <span class="md-ellipsis">About</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Flux Operator" class="md-nav__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    Flux Operator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1">
          <span class="md-ellipsis">Getting Started</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Getting Started</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/index.html" class="md-nav__link">
        <span title="/getting_started/index.md (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html"><span title="/development/index.md (reference label)" class="md-ellipsis">Development</span></a>
          
            <label for="__nav_1_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Development" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          <span title="/development/index.md (reference label)" class="md-ellipsis">Development</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span title="/development/developer-guide.md (reference label)" class="md-ellipsis">Developer Guide</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/development/developer-guide.md (reference label)" class="md-ellipsis">Developer Guide</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span title="/development/developer-guide.md#setup (reference label)" class="md-ellipsis">Setup</span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-development" class="md-nav__link">
    <span title="/development/developer-guide.md#local-development (reference label)" class="md-ellipsis">Local Development</span>
  </a>
  
    <nav class="md-nav" aria-label="Local Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span title="/development/developer-guide.md#quick-start (reference label)" class="md-ellipsis">1.<wbr> Quick Start</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configs" class="md-nav__link">
    <span title="/development/developer-guide.md#configs (reference label)" class="md-ellipsis">2.<wbr> Configs</span>
  </a>
  
    <nav class="md-nav" aria-label="2. Configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-config" class="md-nav__link">
    <span title="/development/developer-guide.md#default-config (reference label)" class="md-ellipsis">Default Config</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-configs" class="md-nav__link">
    <span title="/development/developer-guide.md#example-configs (reference label)" class="md-ellipsis">Example Configs</span>
  </a>
  
    <nav class="md-nav" aria-label="Example Configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flux-restful" class="md-nav__link">
    <span title="/development/developer-guide.md#flux-restful (reference label)" class="md-ellipsis">Flux Restful</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headless-tests" class="md-nav__link">
    <span title="/development/developer-guide.md#headless-tests (reference label)" class="md-ellipsis">Headless Tests</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-with-services" class="md-nav__link">
    <span title="/development/developer-guide.md#interacting-with-services (reference label)" class="md-ellipsis">Interacting with Services</span>
  </a>
  
    <nav class="md-nav" aria-label="Interacting with Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forward" class="md-nav__link">
    <span title="/development/developer-guide.md#port-forward (reference label)" class="md-ellipsis">port-<wbr>forward</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-images" class="md-nav__link">
    <span title="/development/developer-guide.md#build-images (reference label)" class="md-ellipsis">Build Images</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-operator-yaml" class="md-nav__link">
    <span title="/development/developer-guide.md#build-operator-yaml (reference label)" class="md-ellipsis">Build Operator Yaml</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-requirements" class="md-nav__link">
    <span title="/development/developer-guide.md#container-requirements (reference label)" class="md-ellipsis">Container Requirements</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span title="/development/developer-guide.md#testing (reference label)" class="md-ellipsis">Testing</span>
  </a>
  
    <nav class="md-nav" aria-label="Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration" class="md-nav__link">
    <span title="/development/developer-guide.md#integration (reference label)" class="md-ellipsis">Integration</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    <span title="/development/developer-guide.md#documentation (reference label)" class="md-ellipsis">Documentation</span>
  </a>
  
    <nav class="md-nav" aria-label="Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-dependencies-and-build" class="md-nav__link">
    <span title="/development/developer-guide.md#install-dependencies-and-build (reference label)" class="md-ellipsis">Install Dependencies and Build</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preview-documentation" class="md-nav__link">
    <span title="/development/developer-guide.md#preview-documentation (reference label)" class="md-ellipsis">Preview Documentation</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="designs.html" class="md-nav__link">
        <span title="/development/designs.md (reference label)" class="md-ellipsis">Designs</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="debugging.html" class="md-nav__link">
        <span title="/development/debugging.md (reference label)" class="md-ellipsis">Debugging</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="creation.html" class="md-nav__link">
        <span title="/development/creation.md (reference label)" class="md-ellipsis">Operator Creation</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2">
          <span class="md-ellipsis">Deployment</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Deployment</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/index.html" class="md-nav__link">
        <span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3">
          <span class="md-ellipsis">About</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">About</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/index.html" class="md-nav__link">
        <span title="/about/index.md (reference label)" class="md-ellipsis">About the Flux Operator</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/flux-framework/flux-operator/blob/main/docs/development/developer-guide.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
  </a>

<h1 id="developer-guide">Developer Guide<a class="headerlink" href="#developer-guide" title="Permalink to this heading">¶</a></h1>
<p>This developer guide includes complete instructions for setting up a developer
environment.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¶</a></h2>
<p>To work on this operator you should:</p>
<ul class="simple">
<li><p>Have a recent version of Go installed (1.18.1)</p></li>
<li><p>Have minikube installed</p></li>
</ul>
<p><strong>Important</strong> For minikube, make sure to enable <a class="reference external" href="https://minikube.sigs.k8s.io/docs/handbook/addons/ingress-dns/">DNS plugins</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>minikube<span class="w"> </span>addons<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ingress
$<span class="w"> </span>minikube<span class="w"> </span>addons<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ingress-dns
</code></pre></div>
</div>
<p>Note that for production clusters (e.g., <a class="reference external" href="https://cloud.google.com/kubernetes-engine/docs/concepts/ingress">GKE</a>) I believe this
addon is enabled by default. The basic Flux networking (pods seeing one another) won’t work if your cluster does not support DNS.
You also won’t be able to expose the service with minikube service if you don’t do the above (but port-forward would technically work)
You’ll then also want to clone the repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># Clone the source code</span>
$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/flux-framework/flux-operator
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>flux-operator
</code></pre></div>
</div>
<h3 id="local-development">Local Development<a class="headerlink" href="#local-development" title="Permalink to this heading">¶</a></h3>
<p>After cloning, you need to create your MiniKube cluster before doing anything else!</p>
<h4 id="quick-start">1. Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this heading">¶</a></h4>
<p>Here is a quick start for doing that, making the namespace, and installing the operator.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="gp"># </span>Start<span class="w"> </span>a<span class="w"> </span>minikube<span class="w"> </span>cluster
<span class="gp">$ </span>minikube<span class="w"> </span>start

<span class="gp"># </span>Make<span class="w"> </span>a<span class="w"> </span>flux<span class="w"> </span>operator<span class="w"> </span>namespace
<span class="gp">$ </span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>flux-operator
<span class="go">namespace/flux-operator created</span>
</code></pre></div>
</div>
<p>Here is how to build and install the operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code># Build the operator
$ make

# How to make your manifests
$ make manifests

# And install. This places an executable &quot;bin/kustomize&quot;
$ make install
</code></pre></div>
</div>
<h4 id="configs">2. Configs<a class="headerlink" href="#configs" title="Permalink to this heading">¶</a></h4>
<h5 id="default-config">Default Config<a class="headerlink" href="#default-config" title="Permalink to this heading">¶</a></h5>
<p>Our “default” job config, or custom resource definition “CRD” can be found in <a class="reference external" href="https://github.com/flux-framework/flux-operator/tree/main/config/samples">config/samples</a>.
We will walk through how to deploy this one, and then any of the ones in our examples gallery.
First, before launching any jobs, making sure <code class="docutils literal notranslate"><span class="pre">localDeploy</span></code> is set to true in your CRD so you don’t ask for a persistent volume claim!</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="c1"># Set to true to use volume mounts instead of volume claims</span>
<span class="w">  </span><span class="nt">localDeploy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
</div>
<p>The default is set to true (so a local volume in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> is used) but this won’t work on an actual cloud Kubernetes cluster,
and vice versa - the volume claim won’t work locally. When you are sure this is good,
and you’ve built and installed the operator, here is how to “launch”
the Mini Cluster (or if providing a command, an ephemeral job):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config/samples/flux-framework.org_v1alpha1_minicluster.yaml
</code></pre></div>
</div>
<p>there is a courtesy function to clean, and apply the samples:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>clean<span class="w">  </span><span class="c1"># remove old flux-operator namespaced items</span>
$<span class="w"> </span>make<span class="w"> </span>apply<span class="w">  </span><span class="c1"># apply the setup and job config</span>
$<span class="w"> </span>make<span class="w"> </span>run<span class="w">    </span><span class="c1"># make the cluster</span>
</code></pre></div>
</div>
<p>or run all three for easy development!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>redo<span class="w">  </span><span class="c1"># clean, apply, and run</span>
</code></pre></div>
</div>
<p>To see logs for the job, you’d do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>job.batch/flux-sample
</code></pre></div>
</div>
<p>And this is also:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>log
</code></pre></div>
</div>
<p>But the above gives you a (somewhat random?) pod. If you want to see a specific one do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>./script/log.sh<span class="w"> </span>flux-sample-0-b5rw6
</code></pre></div>
</div>
<p>E.g., rank 0 is the “main” one. List running pods (each pod is part of a batch job)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>list
</code></pre></div>
</div>
<p>And shell into one with the helper script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>./script/shell.sh<span class="w"> </span>flux-sample-0-b5rw6
</code></pre></div>
</div>
<p>Note that if you are running more than one container, you need a custom command for shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--stdin<span class="w"> </span>--tty<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-sample-0-vsnvz<span class="w"> </span>-c<span class="w"> </span>flux-sample-1<span class="w"> </span>--<span class="w"> </span>/bin/bash
</code></pre></div>
</div>
<p>Where the first is the name of the pod, and <code class="docutils literal notranslate"><span class="pre">-c</span></code> references the container.</p>
<h5 id="example-configs">Example Configs<a class="headerlink" href="#example-configs" title="Permalink to this heading">¶</a></h5>
<p>We provide an extended gallery of configs for:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/flux-framework/flux-operator/tree/main/examples/flux-restful">Flux Restful Examples</a> that deploy a web interface to submit jobs to.</p></li>
<li><p><a class="reference external" href="https://github.com/flux-framework/flux-operator/tree/main/examples/tests">Headless Test Examples</a> that run commands directly, ideal for testing.</p></li>
</ul>
<p>Generally these sets of configs are the same (e.g., same container bases and other options) and only vary in providing a command entrypoint (for the headless)
or not (for the Flux Restful). To make it easy to clean up your cluster and apply a named config, you have two options:</p>
<h6 id="flux-restful">Flux Restful<a class="headerlink" href="#flux-restful" title="Permalink to this heading">¶</a></h6>
<p>We call this the main set of “examples.” To clean up Minikube, apply a named config, and run the example via a Mini Cluster, first match the name of the yaml
file to a variable name. E.g., for the following files, the names would be:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>tree<span class="w"> </span>examples/flux-restful/
<span class="go">├── minicluster-conveyorlc.yaml       (- name=conveyorlc</span>
<span class="go">├── minicluster-lammps.yaml           (- name=lammps</span>
<span class="go">└── minicluster-osu-benchmarks.yaml   (- name=osu-benchmarks</span>
</code></pre></div>
</div>
<p>This, to run the full example for conveyorlc:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span><span class="nv">name</span><span class="o">=</span>conveyorlc<span class="w"> </span>redo_example<span class="w"> </span>
</code></pre></div>
</div>
<p>Be careful running this on a production cluster, as it will delete all Kubernetes objects in the namespace.
If you just want to just apply the new job and run the cluster, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span><span class="nv">name</span><span class="o">=</span>conveyorlc<span class="w"> </span>example
$<span class="w"> </span>make<span class="w"> </span>run
</code></pre></div>
</div>
<h6 id="headless-tests">Headless Tests<a class="headerlink" href="#headless-tests" title="Permalink to this heading">¶</a></h6>
<p>Our headless tests are modified examples intended to be run without the web interface.
The naming convention is the same as above, except we are concerned with files
in the examples test folder:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>tree<span class="w"> </span>examples/tests/
<span class="go">examples/tests/</span>
<span class="go">├── hello-world           (- name=hello-world</span>
<span class="go">│   └── minicluster.yaml</span>
<span class="go">└── lammps                (- name=lammps</span>
<span class="go">    └── minicluster.yaml</span>
</code></pre></div>
</div>
<p>Thus, to run the full example for hello-world you can do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>bash<span class="w"> </span>script/test.sh<span class="w"> </span>hello-world
</code></pre></div>
</div>
<p>or (for a less scripted run):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span><span class="nv">name</span><span class="o">=</span>hello-world<span class="w"> </span>redo_test<span class="w"> </span>
</code></pre></div>
</div>
<p>If you just want to just apply the new job without a cleanup, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span><span class="nv">name</span><span class="o">=</span>hello-world<span class="w"> </span>applytest
$<span class="w"> </span>make<span class="w"> </span>run
</code></pre></div>
</div>
<p>Note that there is a default sleep of ~20 seconds for all jobs (so the worker nodes start after the broker)
so they will not run instantly. You can list pods to get an id, and then view logs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>list
$<span class="w"> </span>bash<span class="w"> </span>script/log.sh<span class="w"> </span>&lt;pod&gt;
</code></pre></div>
</div>
<p>Also note that these headless tests have <code class="docutils literal notranslate"><span class="pre">test:</span> <span class="pre">true</span></code> in the config,
meaning you will only see output with the command above from what you actually ran.
We do this because we test them in CI, and we don’t want the other verbose output
to get in the way! If you want to disable this quiet mode, just comment out
this parameter in the configuration.</p>
<h3 id="interacting-with-services">Interacting with Services<a class="headerlink" href="#interacting-with-services" title="Permalink to this heading">¶</a></h3>
<p>Currently, the most reliable thing to do is port forward:</p>
<h4 id="port-forward">port-forward<a class="headerlink" href="#port-forward" title="Permalink to this heading">¶</a></h4>
<p>If we run as a ClusterIP, we can accomplish the same with a one off <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">port-forward</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">kubectl port-forward -n flux-operator flux-sample-0-zdhkp 5000:5000</span>
<span class="go">Forwarding from 127.0.0.1:5000 -&gt; 5000</span>
</code></pre></div>
</div>
<p>This means you can open <a class="reference external" href="http://localhost:5000">http://localhost:5000</a> to see the restful API (and interact with it there).</p>
<p>If you want to use a minikube service, this seems to work, but is spotty - I think because
minikube is expecting the service to be available from any pod (it is only running from index 0).
If you want to try this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>minikube<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-restful-service<span class="w"> </span>--url<span class="o">=</span><span class="nb">true</span>
</code></pre></div>
</div>
<p>But for now I’m developing with port forward.</p>
<h2 id="build-images">Build Images<a class="headerlink" href="#build-images" title="Permalink to this heading">¶</a></h2>
<p>If you want to build the “production” images - here is how to do that!
This happens in our Docker CI, however you can build (and deploy if you are an owner) them too!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>docker-build
$<span class="w"> </span>make<span class="w"> </span>docker-push
</code></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># operator lifecycle manager</span>
$<span class="w"> </span>operator-sdk<span class="w"> </span>olm<span class="w"> </span>install
$<span class="w"> </span>make<span class="w"> </span>bundle
$<span class="w"> </span>make<span class="w"> </span>bundle-build
$<span class="w"> </span>make<span class="w"> </span>bundle-push
</code></pre></div>
</div>
<p>And for the catalog:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>catalog-build
$<span class="w"> </span>make<span class="w"> </span>catalog-push
</code></pre></div>
</div>
<h2 id="build-operator-yaml">Build Operator Yaml<a class="headerlink" href="#build-operator-yaml" title="Permalink to this heading">¶</a></h2>
<p>To generate the CRD to install to a cluster, we’ve added a <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">build-config</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>build-config
</code></pre></div>
</div>
<p>That will generate a yaml to install the operator (with default container image) to a
cluster in <code class="docutils literal notranslate"><span class="pre">examples/dist</span></code>.</p>
<h2 id="container-requirements">Container Requirements<a class="headerlink" href="#container-requirements" title="Permalink to this heading">¶</a></h2>
<p>If you are looking to build a container to use with the Flux Operator, we have a set of
example containers <a class="reference external" href="https://github.com/rse-ops/flux-hpc">here</a> and general guidelines are below.
Generally we recommend using the flux-sched base image
so that install locations and users are consistent. This assumes that:</p>
<ul class="simple">
<li><p>we are currently starting focus on supporting debian bases</p></li>
<li><p>if you created the flux user, it has uid 1000</p></li>
<li><p>sudo is available in the container (apt-get install -y sudo)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/flux</span></code> is used for configuration and general setup</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/libexec/flux</span></code> has executables like flux-imp, flux-shell</p></li>
<li><p>flux-core / flux-sched with flux-security should be installed and ready to go.</p></li>
<li><p>If you haven’t created a flux user, one will be created for you (with a common user id 1000)</p></li>
<li><p>Any executables that the flux user needs for your job should be on the path (if launching command directly)</p></li>
<li><p>The container (for now) should start with user root, and we run commands on behalf of flux.</p></li>
<li><p>You don’t need to install the flux-restful-api (it will be installed by the operator)</p></li>
<li><p>munge should be install, and a key generated at <code class="docutils literal notranslate"><span class="pre">/etc/munge/munge.key</span></code></p></li>
</ul>
<p>For the last point, since all Flux running containers should have the same munge key
in that location, we simply use it. The pipeline will fail if the key is missing from any
Flux runner container.  For the curve.cert that we need to secure the cluster, we will
be running your flux runner container before the indexed job is launched, generating
the certificate, and then mapping it into the job pods via another config map.
Note that we considered generating this natively in Gom, however the underlying library to do this
generation that is <a class="reference external" href="https://pkg.go.dev/github.com/zeromq/goczmq#section-readme">available in Go</a>
requires system libraries, and thus would be annoying to add as a dependency.</p>
<p>These criteria are taken from the <a class="reference external" href="https://github.com/flux-framework/flux-sched/blob/master/src/test/docker/focal/Dockerfile">flux-sched</a>
base image <a class="reference external" href="https://hub.docker.com/r/fluxrm/flux-sched">available on Docker hub</a> as <code class="docutils literal notranslate"><span class="pre">fluxrm/flux-sched:focal</span></code>,
and we strongly suggest you use this for your base container to make development easier!
If you intend to use the <a class="reference external" href="https://github.com/flux-framework/flux-restful-api">Flux RESTful API</a>
to interact with your cluster, ensure that flux (python bindings) are on the path, along with
either python or python3 (depending on which you used to install Flux).
If/when needed we can lift some of these constraints, but for now they are
reasonable. If you use this image, you should have python3 and pip3 available to you,
and the active user is <code class="docutils literal notranslate"><span class="pre">fluxuser</span></code>. This means if you want to add content, either you’ll
need to change the user to <code class="docutils literal notranslate"><span class="pre">root</span></code> in a build (and back to <code class="docutils literal notranslate"><span class="pre">fluxuser</span></code> at the end), use sudo, or
install to <code class="docutils literal notranslate"><span class="pre">/home/fluxuser</span></code>.</p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permalink to this heading">¶</a></h2>
<p>Testing is underway! From a high level, we want three kinds of testing:</p>
<ul class="simple">
<li><p>Unit tests, which will be more traditional <code class="docutils literal notranslate"><span class="pre">*_test.go</span></code> files alongside others in the repository (not done yet)</p></li>
<li><p>End to end “e2e” tests, also within Go, to test an entire submission of a job, also within Go. (not done yet)</p></li>
<li><p>Integration testing, likely some within Go and some external to it. (in progress)</p></li>
</ul>
<h3 id="integration">Integration<a class="headerlink" href="#integration" title="Permalink to this heading">¶</a></h3>
<p>For the integration testing outside of Go, we currently have basic tests written that allow the following:</p>
<ol class="arabic simple">
<li><p>Write a custom resource definition (CRD) for a named mini cluster under <code class="docutils literal notranslate"><span class="pre">examples/tests/${name}</span></code> as <code class="docutils literal notranslate"><span class="pre">minicluster.yaml</span></code>.</p></li>
<li><p>The CRD should set <code class="docutils literal notranslate"><span class="pre">test:true</span></code> and include a command to run, and a container to do it.</p></li>
<li><p>Add your test name, container, and estimated running time to <code class="docutils literal notranslate"><span class="pre">.github/workflows/main.yaml</span></code></p></li>
<li><p>If your tests require a working directory, it must be set in the CRD for the headless test.</p></li>
<li><p>If a test is deterministic, add a <code class="docutils literal notranslate"><span class="pre">test.out</span></code> to the output folder that we can validate results for.</p></li>
<li><p>We will validate output (if provided) and that containers exit with 0.</p></li>
</ol>
<p>To run the test (and you can also do this locally) we use the <code class="docutils literal notranslate"><span class="pre">script/test.sh</span></code> and provide a name and the estimated
job time, just like in actions. The below example runs the “hello-world” test and gives it 30 seconds to finish.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>./bin/bash<span class="w"> </span>script/test.sh<span class="w"> </span>hello-world<span class="w"> </span><span class="m">10</span>
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">...</span>
<span class="go">NAME                  READY   STATUS    RESTARTS   AGE</span>
<span class="go">flux-sample-0-ng8c5   1/1     Running   0          3s</span>
<span class="go">flux-sample-1-nxqj9   1/1     Running   0          3s</span>
<span class="go">flux-sample-2-vv7jr   1/1     Running   0          3s</span>
<span class="go">flux-sample-3-kh2br   1/1     Running   0          3s</span>
<span class="go">Pods: flux-sample-0-ng8c5 flux-sample-1-nxqj9 flux-sample-2-vv7jr flux-sample-3-kh2br</span>
<span class="go">Pod: flux-sample-0-ng8c5</span>
<span class="go">Actual:</span>
<span class="go">hello world</span>
<span class="go">Expected:</span>
<span class="go">hello world</span>
</code></pre></div>
</div>
<p>What you don’t see in the above is that we also use kubectl to ensure that the exit code for all containers
(typically 4) is 0. Also note that the “sleep” time doesn’t have to be exact, it’s technically not necessary because we are waiting
for the output to finish coming (and the job to stop). I added it to provide a courtesy message to the user and developer.
Finally, note that for big containers it’s suggested to pull them first, e.g.,:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>minikube<span class="w"> </span>ssh<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>ghcr.io/rse-ops/lammps:flux-sched-focal-v0.24.0
</code></pre></div>
</div>
<p>The tests above are headless, meaning they submit commands directly, and that way
we don’t need to do it in the UI and can programmatically determine if they were successful.
Finally, note that if you have commands that you need to run before or after the tests,
you can add a <code class="docutils literal notranslate"><span class="pre">pre-run.sh</span></code> or <code class="docutils literal notranslate"><span class="pre">post-run.sh</span></code> in the directory. As an example, because minikube
is run inside of a VM, if you are using a host volume mount, it won’t actually show up on your host!
This is because it’s inside the VM. This you might want to move files there before the test, e.g.,:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">HERE</span><span class="o">=</span><span class="k">$(</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="w"> </span>dirname<span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="w"> </span><span class="k">)</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Copying local volume to /tmp/data-volumes in minikube&quot;</span>

<span class="c1"># We don&#39;t care if this works or not - mkdir -p seems to bork</span>
minikube<span class="w"> </span>ssh<span class="w"> </span>--<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/data-volumes
minikube<span class="w"> </span>cp<span class="w"> </span><span class="si">${</span><span class="nv">HERE</span><span class="si">}</span>/data/pancakes.txt<span class="w"> </span>/tmp/data-volumes/pancakes.txt
minikube<span class="w"> </span>ssh<span class="w"> </span>ls<span class="w"> </span>/tmp/data-volumes
</code></pre></div>
</div>
<p>and then clean up after</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Cleaning up /tmp/data-volumes in minikube&quot;</span>
minikube<span class="w"> </span>ssh<span class="w"> </span>--<span class="w"> </span>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/tmp/data-volumes
</code></pre></div>
</div>
<p>This would be the same for anytime you use minikube and want to create a local volume. It’s not actually on your host,
but rather in the VM. For an example test that does this, see the <code class="docutils literal notranslate"><span class="pre">examples/tests/volumes</span></code> example.</p>
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">¶</a></h2>
<p>The documentation is provided in the <code class="docutils literal notranslate"><span class="pre">docs</span></code> folder of the repository, and generally most content that you might want to add is under
<code class="docutils literal notranslate"><span class="pre">getting_started</span></code>. For ease of contribution, files that are likely to be updated by contributors (e.g., mostly everything but the module generated files)
are written in markdown. If you need to use <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html#table-of-contents">toctree</a> you should not use extra newlines or spaces (see index.md files for examples). The documentation is also provided in Markdown (instead of rst or restructured syntax) to make contribution easier for the community.</p>
<p>Finally, we recommend you use the same development environment also to build and work on
documentation. The reason is because we import the app to derive docstrings,
and this will require having Flux.</p>
<h3 id="install-dependencies-and-build">Install Dependencies and Build<a class="headerlink" href="#install-dependencies-and-build" title="Permalink to this heading">¶</a></h3>
<p>The documentation is built using sphinx, and generally you can
create a virtual environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>docs
$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>env<span class="w"> </span>
$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>env/bin/activate
</code></pre></div>
</div>
<p>And then install dependencies:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="gp"># </span>Build<span class="w"> </span>the<span class="w"> </span>docs<span class="w"> </span>into<span class="w"> </span>_build/html
<span class="gp">$ </span>make<span class="w"> </span>html
</code></pre></div>
</div>
<h3 id="preview-documentation">Preview Documentation<a class="headerlink" href="#preview-documentation" title="Permalink to this heading">¶</a></h3>
<p>After <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> you can enter into <code class="docutils literal notranslate"><span class="pre">_build/html</span></code> and start a local web
server to preview:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">9999</span>
</code></pre></div>
</div>
<p>And open your browser to <code class="docutils literal notranslate"><span class="pre">localhost:9999</span></code></p>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Jan 27, 2023
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Development" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Development
            </div>
          </div>
        </a>
      
      
        
        <a href="designs.html" class="md-footer__link md-footer__link--next" aria-label="Next: Designs" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Designs
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2022, Flux Developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    5.3.0.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/flux-framework/flux-operator" target="_blank" rel="noopener" title="Flux Operator on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://flux-framework.org/" target="_blank" rel="noopener" title="Flux Framework" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 2.05c5.05.5 9 4.77 9 9.95 0 1.45-.32 2.83-.88 4.07l-2.62-1.53c.32-.79.5-1.64.5-2.54 0-3.53-2.61-6.43-6-6.92V2.05M12 19c2.21 0 4.17-1 5.45-2.62l2.6 1.53A9.97 9.97 0 0 1 12 22C6.47 22 2 17.5 2 12a9.99 9.99 0 0 1 9-9.95v3.03C7.61 5.57 5 8.47 5 12a7 7 0 0 0 7 7m0-13a6 6 0 0 1 6 6c0 2.97-2.16 5.44-5 5.92v-3.09c1.17-.41 2-1.52 2-2.83a3 3 0 0 0-3-3l-.55.05-1.54-2.67C10.56 6.13 11.26 6 12 6m-6 6c0-1.86.85-3.5 2.18-4.62l1.54 2.67C9.27 10.57 9 11.26 9 12c0 1.31.83 2.42 2 2.83v3.09c-2.84-.48-5-2.95-5-5.92Z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.tabs", "toc.integrate", "navigation.sections", "navigation.instant", "header.autohide", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "toc.follow", "toc.sticky", "content.tabs.link", "announce.dismiss"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../_static/sphinx_immaterial_theme.cea6a0c1d5b0618cf.min.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/js/rtd_sphinx_search.min.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>