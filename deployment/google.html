


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../_static/favicon.ico">
    
    
      
        <title>Google Cloud - Flux Operator</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../_static/sphinx_immaterial_theme.fa3fbbd75cfdd7cef.min.css" />
        <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

<!-- Social: Facebook / Open Graph -->
<title>Flux Operator </title>
<link rel="canonical" href="https://flux-framework.github.io/flux-operator/"/>
<meta property="og:type" content="website">

<meta property="og:url" content="https://flux-framework.github.io/flux-operator/">
<meta property="og:title" content="Flux Operator">
<meta property="og:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<meta property="og:description" content="Flux Operator ">
<meta property="og:site_name" content="Flux Operator">
<meta property="og:locale" content="en_US">

<!-- Social: Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@FluxFramework">
<meta name="twitter:title" content="Flux Framework">
<meta name="twitter:description" content="Flux Operator ">
<meta name="twitter:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">

<!-- Social: Google+ / Schema.org  -->
<meta itemprop="name" content="Flux Operator">
<meta itemprop="description" content="Flux Operator ">
<meta itemprop="image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<script type="application/ld+json">
  {"@type":"WebSite","headline":"Flux Operator","url":"https://flux-framework.github.io/flux-operator","description":"The Flux Operator creates Flux MiniClusters on Kubernetes ","name":"Flux Operator","@context":"https://schema.org"}
</script>

<style>
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 48
}
.sphx-glr-script-out .highlight pre {
  background-color: #def0ff !important;
}
  </style>




  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Flux Operator" class="md-header__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flux Operator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Google Cloud
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../getting_started/index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">Getting Started</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../getting_started/tutorials/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Tutorials</span>
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">Deployment</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../about/index.html" class="md-tabs__link">
      <span class="md-ellipsis">About</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Flux Operator" class="md-nav__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    Flux Operator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1">
          <span class="md-ellipsis">Getting Started</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Getting Started</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/index.html" class="md-nav__link">
        <span title="/getting_started/index.md (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/index.html" class="md-nav__link">
        <span title="/development/index.md (reference label)" class="md-ellipsis">Development</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html"><span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span></a>
          
            <label for="__nav_1_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Clouds" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="minikube.html" class="md-nav__link">
        <span title="/deployment/minikube.md (reference label)" class="md-ellipsis">Mini<wbr>Kube</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="aws.html" class="md-nav__link">
        <span title="/deployment/aws.md (reference label)" class="md-ellipsis">Amazon Web Services</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span title="/deployment/google.md (reference label)" class="md-ellipsis">Google Cloud</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/deployment/google.md (reference label)" class="md-ellipsis">Google Cloud</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span title="/deployment/google.md#setup (reference label)" class="md-ellipsis">Setup</span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span title="/deployment/google.md#install (reference label)" class="md-ellipsis">Install</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-cluster" class="md-nav__link">
    <span title="/deployment/google.md#create-cluster (reference label)" class="md-ellipsis">Create Cluster</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-credentials" class="md-nav__link">
    <span title="/deployment/google.md#get-credentials (reference label)" class="md-ellipsis">Get Credentials</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-operator" class="md-nav__link">
    <span title="/deployment/google.md#deploy-operator (reference label)" class="md-ellipsis">Deploy Operator</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-flux-operator-namespace" class="md-nav__link">
    <span title="/deployment/google.md#create-flux-operator-namespace (reference label)" class="md-ellipsis">Create Flux Operator namespace</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lammps-on-google-kubernetes-engine" class="md-nav__link">
    <span title="/deployment/google.md#lammps-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Lammps on Google Kubernetes Engine</span>
  </a>
  
    <nav class="md-nav" aria-label="Lammps on Google Kubernetes Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-resource-definition" class="md-nav__link">
    <span title="/deployment/google.md#custom-resource-definition (reference label)" class="md-ellipsis">Custom Resource Definition</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-lammps-job" class="md-nav__link">
    <span title="/deployment/google.md#create-the-lammps-job (reference label)" class="md-ellipsis">Create the Lammps Job</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snakemake-requiring-storage-on-google-kubernetes-engine" class="md-nav__link">
    <span title="/deployment/google.md#snakemake-requiring-storage-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Snakemake <wbr>(requiring storage) on Google Kubernetes Engine</span>
  </a>
  
    <nav class="md-nav" aria-label="Snakemake (requiring storage) on Google Kubernetes Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    <span title="/deployment/google.md#prepare-data (reference label)" class="md-ellipsis">Prepare Data</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-the-constainer-storage-driver-csi" class="md-nav__link">
    <span title="/deployment/google.md#install-the-constainer-storage-driver-csi (reference label)" class="md-ellipsis">Install the Constainer Storage Driver <wbr>(CSI)</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permissions-via-secrets" class="md-nav__link">
    <span title="/deployment/google.md#permissions-via-secrets (reference label)" class="md-ellipsis">Permissions via Secrets</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-class" class="md-nav__link">
    <span title="/deployment/google.md#storage-class (reference label)" class="md-ellipsis">Storage Class</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snakemake-minicluster" class="md-nav__link">
    <span title="/deployment/google.md#snakemake-minicluster (reference label)" class="md-ellipsis">Snakemake Mini<wbr>Cluster</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span title="/deployment/google.md#clean-up (reference label)" class="md-ellipsis">Clean up</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization-and-debugging" class="md-nav__link">
    <span title="/deployment/google.md#customization-and-debugging (reference label)" class="md-ellipsis">Customization and Debugging</span>
  </a>
  
    <nav class="md-nav" aria-label="Customization and Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span title="/deployment/google.md#firewall (reference label)" class="md-ellipsis">Firewall</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2">
          <span class="md-ellipsis">Tutorials</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Tutorials</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/tutorials/index.html" class="md-nav__link">
        <span title="/getting_started/tutorials/index.md (reference label)" class="md-ellipsis">Tutorials</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3">
          <span class="md-ellipsis">Deployment</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Deployment</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html"><span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span></a>
          
            <label for="__nav_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Clouds" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="minikube.html" class="md-nav__link">
        <span title="/deployment/minikube.md (reference label)" class="md-ellipsis">Mini<wbr>Kube</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="aws.html" class="md-nav__link">
        <span title="/deployment/aws.md (reference label)" class="md-ellipsis">Amazon Web Services</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
    
    <li class="md-nav__item md-nav__item--active md-nav__current-nested md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3" type="checkbox" id="__nav_3_1_3" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index md-nav__link--active">
          <a href="#"><span title="/deployment/google.md (reference label)" class="md-ellipsis">Google Cloud</span></a>
          
            <label for="__nav_3_1_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Google Cloud" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_3">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/google.md (reference label)" class="md-ellipsis">Google Cloud</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3_1_3_1" type="checkbox" id="__nav_3_1_3_1" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="#setup"><span title="/deployment/google.md#setup (reference label)" class="md-ellipsis">Setup</span></a>
          
            <label for="__nav_3_1_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Setup" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/google.md#setup (reference label)" class="md-ellipsis">Setup</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#install" class="md-nav__link">
        <span title="/deployment/google.md#install (reference label)" class="md-ellipsis">Install</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#create-cluster" class="md-nav__link">
        <span title="/deployment/google.md#create-cluster (reference label)" class="md-ellipsis">Create Cluster</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#get-credentials" class="md-nav__link">
        <span title="/deployment/google.md#get-credentials (reference label)" class="md-ellipsis">Get Credentials</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#deploy-operator" class="md-nav__link">
        <span title="/deployment/google.md#deploy-operator (reference label)" class="md-ellipsis">Deploy Operator</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#create-flux-operator-namespace" class="md-nav__link">
        <span title="/deployment/google.md#create-flux-operator-namespace (reference label)" class="md-ellipsis">Create Flux Operator namespace</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3_1_3_2" type="checkbox" id="__nav_3_1_3_2" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="#lammps-on-google-kubernetes-engine"><span title="/deployment/google.md#lammps-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Lammps on Google Kubernetes Engine</span></a>
          
            <label for="__nav_3_1_3_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Lammps on Google Kubernetes Engine" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_2">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/google.md#lammps-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Lammps on Google Kubernetes Engine</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#custom-resource-definition" class="md-nav__link">
        <span title="/deployment/google.md#custom-resource-definition (reference label)" class="md-ellipsis">Custom Resource Definition</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#create-the-lammps-job" class="md-nav__link">
        <span title="/deployment/google.md#create-the-lammps-job (reference label)" class="md-ellipsis">Create the Lammps Job</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3_1_3_3" type="checkbox" id="__nav_3_1_3_3" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="#snakemake-requiring-storage-on-google-kubernetes-engine"><span title="/deployment/google.md#snakemake-requiring-storage-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Snakemake <wbr>(requiring storage) on Google Kubernetes Engine</span></a>
          
            <label for="__nav_3_1_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Snakemake (requiring storage) on Google Kubernetes Engine" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_3">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/google.md#snakemake-requiring-storage-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Snakemake <wbr>(requiring storage) on Google Kubernetes Engine</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#prepare-data" class="md-nav__link">
        <span title="/deployment/google.md#prepare-data (reference label)" class="md-ellipsis">Prepare Data</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#install-the-constainer-storage-driver-csi" class="md-nav__link">
        <span title="/deployment/google.md#install-the-constainer-storage-driver-csi (reference label)" class="md-ellipsis">Install the Constainer Storage Driver <wbr>(CSI)</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#permissions-via-secrets" class="md-nav__link">
        <span title="/deployment/google.md#permissions-via-secrets (reference label)" class="md-ellipsis">Permissions via Secrets</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#storage-class" class="md-nav__link">
        <span title="/deployment/google.md#storage-class (reference label)" class="md-ellipsis">Storage Class</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#snakemake-minicluster" class="md-nav__link">
        <span title="/deployment/google.md#snakemake-minicluster (reference label)" class="md-ellipsis">Snakemake Mini<wbr>Cluster</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#clean-up" class="md-nav__link">
        <span title="/deployment/google.md#clean-up (reference label)" class="md-ellipsis">Clean up</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3_1_3_5" type="checkbox" id="__nav_3_1_3_5" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="#customization-and-debugging"><span title="/deployment/google.md#customization-and-debugging (reference label)" class="md-ellipsis">Customization and Debugging</span></a>
          
            <label for="__nav_3_1_3_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Customization and Debugging" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_5">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/google.md#customization-and-debugging (reference label)" class="md-ellipsis">Customization and Debugging</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="#firewall" class="md-nav__link">
        <span title="/deployment/google.md#firewall (reference label)" class="md-ellipsis">Firewall</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  
      
    <li class="md-nav__item md-nav__item--active md-nav__current-toc">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span title="/deployment/google.md (reference label)" class="md-ellipsis">Google Cloud</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/deployment/google.md (reference label)" class="md-ellipsis">Google Cloud</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span title="/deployment/google.md#setup (reference label)" class="md-ellipsis">Setup</span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span title="/deployment/google.md#install (reference label)" class="md-ellipsis">Install</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-cluster" class="md-nav__link">
    <span title="/deployment/google.md#create-cluster (reference label)" class="md-ellipsis">Create Cluster</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-credentials" class="md-nav__link">
    <span title="/deployment/google.md#get-credentials (reference label)" class="md-ellipsis">Get Credentials</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-operator" class="md-nav__link">
    <span title="/deployment/google.md#deploy-operator (reference label)" class="md-ellipsis">Deploy Operator</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-flux-operator-namespace" class="md-nav__link">
    <span title="/deployment/google.md#create-flux-operator-namespace (reference label)" class="md-ellipsis">Create Flux Operator namespace</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lammps-on-google-kubernetes-engine" class="md-nav__link">
    <span title="/deployment/google.md#lammps-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Lammps on Google Kubernetes Engine</span>
  </a>
  
    <nav class="md-nav" aria-label="Lammps on Google Kubernetes Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-resource-definition" class="md-nav__link">
    <span title="/deployment/google.md#custom-resource-definition (reference label)" class="md-ellipsis">Custom Resource Definition</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-lammps-job" class="md-nav__link">
    <span title="/deployment/google.md#create-the-lammps-job (reference label)" class="md-ellipsis">Create the Lammps Job</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snakemake-requiring-storage-on-google-kubernetes-engine" class="md-nav__link">
    <span title="/deployment/google.md#snakemake-requiring-storage-on-google-kubernetes-engine (reference label)" class="md-ellipsis">Snakemake <wbr>(requiring storage) on Google Kubernetes Engine</span>
  </a>
  
    <nav class="md-nav" aria-label="Snakemake (requiring storage) on Google Kubernetes Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    <span title="/deployment/google.md#prepare-data (reference label)" class="md-ellipsis">Prepare Data</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-the-constainer-storage-driver-csi" class="md-nav__link">
    <span title="/deployment/google.md#install-the-constainer-storage-driver-csi (reference label)" class="md-ellipsis">Install the Constainer Storage Driver <wbr>(CSI)</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permissions-via-secrets" class="md-nav__link">
    <span title="/deployment/google.md#permissions-via-secrets (reference label)" class="md-ellipsis">Permissions via Secrets</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-class" class="md-nav__link">
    <span title="/deployment/google.md#storage-class (reference label)" class="md-ellipsis">Storage Class</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snakemake-minicluster" class="md-nav__link">
    <span title="/deployment/google.md#snakemake-minicluster (reference label)" class="md-ellipsis">Snakemake Mini<wbr>Cluster</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span title="/deployment/google.md#clean-up (reference label)" class="md-ellipsis">Clean up</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization-and-debugging" class="md-nav__link">
    <span title="/deployment/google.md#customization-and-debugging (reference label)" class="md-ellipsis">Customization and Debugging</span>
  </a>
  
    <nav class="md-nav" aria-label="Customization and Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span title="/deployment/google.md#firewall (reference label)" class="md-ellipsis">Firewall</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4">
          <span class="md-ellipsis">About</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">About</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/index.html" class="md-nav__link">
        <span title="/about/index.md (reference label)" class="md-ellipsis">About the Flux Operator</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/flux-framework/flux-operator/blob/main/docs/deployment/google.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
  </a>

<h1 id="google-cloud">Google Cloud<a class="headerlink" href="#google-cloud" title="Permalink to this heading">¶</a></h1>
<p>On Google Cloud, “GKE” refers to Google Kubernetes Engine. Kubernetes was originally a Google project,
so it works really well on Google Cloud, and it’s super fun to use the Flux Operator there! This
guide will walk you through the basics. We will be deploying a simple <a class="reference external" href="https://www.lammps.org/">lammps</a> workflow as
shown below.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¶</a></h2>
<p>Whether you choose the LAMMPS or Snakemake tutorial below, the setup for Google cloud is the same!
Follow these steps and then continue on to either of the tutorials.</p>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permalink to this heading">¶</a></h3>
<p>You should first <a class="reference external" href="https://cloud.google.com/sdk/docs/quickstarts">install gcloud</a>
and ensure you are logged in and have kubectl installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>auth<span class="w"> </span>login
</code></pre></div>
</div>
<p>Depending on your install, you can either install kubectl with gcloud:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>components<span class="w"> </span>install<span class="w"> </span>kubectl
</code></pre></div>
</div>
<p>or just <a class="reference external" href="https://kubernetes.io/docs/tasks/tools/">on your own</a>. I already
had it installed so I was good to go.</p>
<h3 id="create-cluster">Create Cluster<a class="headerlink" href="#create-cluster" title="Permalink to this heading">¶</a></h3>
<p>Now let’s use gcloud to create a cluster, and we are purposefully going to choose
a very small node type to test. Note that I choose us-central1-a because it tends
to be cheaper (and closer to me). First, here is our project for easy access:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="nv">GOOGLE_PROJECT</span><span class="o">=</span>myproject
</code></pre></div>
</div>
<p>Replace the above with your project name, of course!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>create<span class="w"> </span>flux-cluster<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--cluster-version<span class="w"> </span><span class="m">1</span>.23<span class="w"> </span>--machine-type<span class="w"> </span>n1-standard-1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num-nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--enable-network-policy<span class="w"> </span>--tags<span class="o">=</span>flux-cluster<span class="w"> </span>--enable-intra-node-visibility
</code></pre></div>
</div>
<p>Note that not all of the flags above might be necessary - I did a lot of testing to get
this working and didn’t go back and try removing things after the fact!
If you want to use cloud dns instead (after <a class="reference external" href="https://console.cloud.google.com/apis/library/dns.googleapis.com">enabling it</a>)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>beta<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>create<span class="w"> </span>flux-cluster<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--cluster-version<span class="w"> </span><span class="m">1</span>.23<span class="w"> </span>--machine-type<span class="w"> </span>n1-standard-1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num-nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--enable-network-policy<span class="w"> </span>--tags<span class="o">=</span>flux-cluster<span class="w"> </span>--enable-intra-node-visibility<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-dns<span class="o">=</span>clouddns<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-dns-scope<span class="o">=</span>cluster
</code></pre></div>
</div>
<p>In your Google cloud interface, you should be able to see the cluster! Note
this might take a few minutes.</p>
<p><img alt="img/cluster.png" src="../_images/cluster.png" /></p>
<p>I also chose a tiny size (nodes and instances) anticipating having it up longer to figure things out.</p>
<h3 id="get-credentials">Get Credentials<a class="headerlink" href="#get-credentials" title="Permalink to this heading">¶</a></h3>
<p>Next we need to ensure that we can issue commands to our cluster with kubectl.
To get credentials, in the view shown above, select the cluster and click “connect.”
Doing so will show you the correct statement to run to configure command-line access,
which probably looks something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>get-credentials<span class="w"> </span>flux-cluster<span class="w"> </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span>
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">Fetching cluster endpoint and auth data.</span>
<span class="go">kubeconfig entry generated for flux-cluster.</span>
</code></pre></div>
</div>
<p>Finally, use <a class="reference external" href="https://cloud.google.com/iam">cloud IAM</a> to ensure you can create roles, etc.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>clusterrolebinding<span class="w"> </span>cluster-admin-binding<span class="w"> </span>--clusterrole<span class="w"> </span>cluster-admin<span class="w"> </span>--user<span class="w"> </span><span class="k">$(</span>gcloud<span class="w"> </span>config<span class="w"> </span>get-value<span class="w"> </span>core/account<span class="k">)</span>
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">clusterrolebinding.rbac.authorization.k8s.io/cluster-admin-binding created</span>
</code></pre></div>
</div>
<p>At this point you should be able to get your nodes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">NAME                                            STATUS   ROLES    AGE     VERSION</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-379m   Ready    &lt;none&gt;   3m41s   v1.23.14-gke.1800</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-3wf9   Ready    &lt;none&gt;   3m42s   v1.23.14-gke.1800</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-c174   Ready    &lt;none&gt;   3m42s   v1.23.14-gke.1800</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-zz1q   Ready    &lt;none&gt;   3m42s   v1.23.14-gke.1800</span>
</code></pre></div>
</div>
<h3 id="deploy-operator">Deploy Operator<a class="headerlink" href="#deploy-operator" title="Permalink to this heading">¶</a></h3>
<p>To deploy the Flux Operator, <a class="reference external" href="https://flux-framework.org/flux-operator/getting_started/user-guide.html#production-install">choose one of the options here</a> to deploy the operator. Whether you apply a yaml file, use <a class="reference external" href="https://converged-computing.github.io/flux-cloud">flux-cloud</a> or clone the repository and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy</span></code> you will see the operator install to the <code class="docutils literal notranslate"><span class="pre">operator-system</span></code> namespace.</p>
<p>For a quick “production deploy” from development, the Makefile has a directive that will build and push a <code class="docutils literal notranslate"><span class="pre">test</span></code> tag (you’ll need to edit <code class="docutils literal notranslate"><span class="pre">DEVIMG</span></code> to be one you can push to) and then generate a
yaml file targeting that image, e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>test-deploy
$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator-dev.yaml
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">...</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-manager-role created</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-metrics-reader created</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-proxy-role created</span>
<span class="go">rolebinding.rbac.authorization.k8s.io/operator-leader-election-rolebinding created</span>
<span class="go">clusterrolebinding.rbac.authorization.k8s.io/operator-manager-rolebinding created</span>
<span class="go">clusterrolebinding.rbac.authorization.k8s.io/operator-proxy-rolebinding created</span>
<span class="go">configmap/operator-manager-config created</span>
<span class="go">service/operator-controller-manager-metrics-service created</span>
<span class="go">deployment.apps/operator-controller-manager created</span>
</code></pre></div>
</div>
<p>Ensure the <code class="docutils literal notranslate"><span class="pre">operator-system</span></code> namespace was created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>namespace
NAME<span class="w">              </span>STATUS<span class="w">   </span>AGE
default<span class="w">           </span>Active<span class="w">   </span>6m39s
kube-node-lease<span class="w">   </span>Active<span class="w">   </span>6m42s
kube-public<span class="w">       </span>Active<span class="w">   </span>6m42s
kube-system<span class="w">       </span>Active<span class="w">   </span>6m42s
operator-system<span class="w">   </span>Active<span class="w">   </span>39s
</code></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>namespace<span class="w"> </span>operator-system
Name:<span class="w">         </span>operator-system
Labels:<span class="w">       </span>control-plane<span class="o">=</span>controller-manager
<span class="w">              </span>kubernetes.io/metadata.name<span class="o">=</span>operator-system
Annotations:<span class="w">  </span>&lt;none&gt;
Status:<span class="w">       </span>Active

Resource<span class="w"> </span>Quotas
<span class="w">  </span>Name:<span class="w">                              </span>gke-resource-quotas
<span class="w">  </span>Resource<span class="w">                           </span>Used<span class="w">  </span>Hard
<span class="w">  </span>--------<span class="w">                           </span>---<span class="w">   </span>---
<span class="w">  </span>count/ingresses.extensions<span class="w">         </span><span class="m">0</span><span class="w">     </span><span class="m">100</span>
<span class="w">  </span>count/ingresses.networking.k8s.io<span class="w">  </span><span class="m">0</span><span class="w">     </span><span class="m">100</span>
<span class="w">  </span>count/jobs.batch<span class="w">                   </span><span class="m">0</span><span class="w">     </span>5k
<span class="w">  </span>pods<span class="w">                               </span><span class="m">1</span><span class="w">     </span><span class="m">1500</span>
<span class="w">  </span>services<span class="w">                           </span><span class="m">1</span><span class="w">     </span><span class="m">500</span>

No<span class="w"> </span>LimitRange<span class="w"> </span>resource.
</code></pre></div>
</div>
<p>And you can find the name of the operator pod as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>--all-namespaces
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">      &lt;none&gt;</span>
<span class="go">operator-system   operator-controller-manager-56b5bcf9fd-m8wg4               2/2     Running   0          73s</span>
</code></pre></div>
</div>
<h3 id="create-flux-operator-namespace">Create Flux Operator namespace<a class="headerlink" href="#create-flux-operator-namespace" title="Permalink to this heading">¶</a></h3>
<p>Make your namespace for the flux-operator custom resource definition (CRD), which is the yaml file above that generates the MiniCluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>flux-operator
</code></pre></div>
</div>
<h2 id="lammps-on-google-kubernetes-engine">Lammps on Google Kubernetes Engine<a class="headerlink" href="#lammps-on-google-kubernetes-engine" title="Permalink to this heading">¶</a></h2>
<p>In this short experiment we will run the Flux Operator on Google Cloud, at
at a fairly small size intended for development.</p>
<h3 id="custom-resource-definition">Custom Resource Definition<a class="headerlink" href="#custom-resource-definition" title="Permalink to this heading">¶</a></h3>
<p>The Custom Resource Definition (CRD) defines our Mini Cluster, and is what we hand to the flux
operator to create it.  Here is the CRD for a small lammps run.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-framework.org/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MiniCluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-sample</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-operator</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Number of pods to create for MiniCluster</span>
<span class="w">  </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>

<span class="w">  </span><span class="c1"># Disable verbose output</span>
<span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">    </span><span class="nt">quiet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="c1"># This is a list because a pod can support multiple containers</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># The container URI to pull (currently needs to be public)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/rse-ops/lammps:flux-sched-focal-v0.24.0</span>

<span class="w">      </span><span class="c1"># You can set the working directory if your container WORKDIR is not correct.</span>
<span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/flux/examples/reaxff/HNS</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lmp -v x 2 -v y 2 -v z 2 -in in.reaxc.hns -nocite</span>
</code></pre></div>
</div>
<p>You can save the above file as <code class="docutils literal notranslate"><span class="pre">minicluster-lammps.yaml</span></code> to get started.</p>
<h3 id="create-the-lammps-job">Create the Lammps Job<a class="headerlink" href="#create-the-lammps-job" title="Permalink to this heading">¶</a></h3>
<p>Now let’s apply the custom resource definition to create the lammps mini cluster!
The file we generated above should be in your present working directory.
Importantly, we have set <code class="docutils literal notranslate"><span class="pre">localDeploy</span></code> to false because we need to create volume
claims and not local host mounts for shared resources.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>minicluster-lammps.yaml
</code></pre></div>
</div>
<p>There are different ways to see logs for pods. First, see pods running and state.
You probably want to wait until the state changes from <code class="docutils literal notranslate"><span class="pre">ContainersCreating</span></code> to <code class="docutils literal notranslate"><span class="pre">Running</span></code>
because this is where we are pulling the chonker containers.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>pods
</code></pre></div>
</div>
<p>If you need to debug (or see general output for a pod about creation) you can do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>describe<span class="w"> </span>pods<span class="w"> </span>flux-sample-0-742bm
</code></pre></div>
</div>
<p>And finally, the most meaty piece of metadata is the log for the pod,
where the Flux Operator will be setting things up and starting flux.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># Add the -f to keep it hanging</span>
$<span class="w"> </span>kubectl<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>logs<span class="w"> </span>flux-sample-0-742bm<span class="w"> </span>-f
</code></pre></div>
</div>
<p>To shell into a pod to look around (noting where important flux stuff is)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--stdin<span class="w"> </span>--tty<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-sample-0-742bm<span class="w"> </span>--<span class="w"> </span>/bin/bash
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">ls /mnt/curve</span>
<span class="go">ls /etc/flux</span>
<span class="go">ls /etc/flux/config</span>
</code></pre></div>
</div>
<p>To get logs for the operator itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>operator-system<span class="w"> </span>operator-controller-manager-56b5bcf9fd-j2g75
</code></pre></div>
</div>
<p>If you need to run in verbose (non-test) mode, set test to false in the <a class="reference internal" href="#minicluster-lammps.yaml"><span class="xref myst">minicluster-lammps.yaml</span></a>.
And make sure to clean up first:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>minicluster-lammps.yaml
</code></pre></div>
</div>
<p>and wait until the pods are gone:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>pods
No<span class="w"> </span>resources<span class="w"> </span>found<span class="w"> </span><span class="k">in</span><span class="w"> </span>flux-operator<span class="w"> </span>namespace.
</code></pre></div>
</div>
<p>Observations about comparing this to MiniKube (local):</p>
<ul class="simple">
<li><p>The containers that are large actually pull!</p></li>
<li><p>The startup times of the different pods vary quite a bit.</p></li>
<li><p>A few config maps aren’t found or timed out mount for up to 3-4 minutes, then it runs.</p></li>
<li><p>Sometimes it also runs quickly!</p></li>
</ul>
<p>If you want to run the same workflow again, use <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">delete</span> <span class="pre">-f</span></code> with the file
and apply it again. I wound up running with test set to true, and then saving the logs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>logs<span class="w"> </span>flux-sample-0-qc5z2<span class="w"> </span>&gt;<span class="w"> </span>lammps.out
</code></pre></div>
</div>
<p>For fun, here is the first successful run of Lammps using the Flux Operator on GCP
ever!</p>
<p><img alt="img/lammps.png" src="../_images/lammps.png" /></p>
<p>Then to delete your lammps MiniCluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>minicluster-lammps.yaml
</code></pre></div>
</div>
<h2 id="snakemake-requiring-storage-on-google-kubernetes-engine">Snakemake (requiring storage) on Google Kubernetes Engine<a class="headerlink" href="#snakemake-requiring-storage-on-google-kubernetes-engine" title="Permalink to this heading">¶</a></h2>
<p>Akin to how we created a local volume, we can do something similar, but instead of pointing the Flux Operator
to a volume on the host (e.g., in MiniKube) we are going to point it to a storage bucket with our data.
For Google cloud, the Flux Operator currently uses the <a class="reference external" href="https://github.com/ofek/csi-gcs">this driver</a> to
connect a cloud storage bucket to our cluster.</p>
<h3 id="prepare-data">Prepare Data<a class="headerlink" href="#prepare-data" title="Permalink to this heading">¶</a></h3>
<p>To start, prepare your data in a temporary directory (that we will upload into Google cloud storage):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/snakemake/snakemake-tutorial-data<span class="w"> </span>/tmp/workflow
</code></pre></div>
</div>
<p>You’ll want to add the <a class="reference external" href="https://github.com/rse-ops/flux-hpc/blob/main/snakemake/atacseq/Snakefile">Snakefile</a> for your workflow
along with a <a class="reference external" href="https://github.com/rse-ops/flux-hpc/blob/main/snakemake/atacseq/scripts/plot-quals.py">plotting script</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>wget<span class="w"> </span>-O<span class="w"> </span>/tmp/workflow/Snakefile<span class="w"> </span>https://raw.githubusercontent.com/rse-ops/flux-hpc/main/snakemake/atacseq/Snakefile
$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/workflow/scripts
$<span class="w"> </span>wget<span class="w"> </span>-O<span class="w"> </span>/tmp/workflow/scripts/plot-quals.py<span class="w"> </span>https://raw.githubusercontent.com/rse-ops/flux-hpc/main/snakemake/atacseq/scripts/plot-quals.py
</code></pre></div>
</div>
<p>You should have this structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>/tmp/workflow
</code></pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>/tmp/workflow/
├── data
│   ├── genome.fa
│   ├── genome.fa.amb
│   ├── genome.fa.ann
│   ├── genome.fa.bwt
│   ├── genome.fa.fai
│   ├── genome.fa.pac
│   ├── genome.fa.sa
│   └── samples
│       ├── A.fastq
│       ├── B.fastq
│       └── C.fastq
├── Dockerfile
├── environment.yaml
├── README.md
├── scripts
│   └── plot-quals.py
└── Snakefile
</code></pre></div>
</div>
<p>We can then use Google Cloud (<code class="docutils literal notranslate"><span class="pre">gcloud</span></code>) to create a bucket and upload to it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>storage<span class="w"> </span>buckets<span class="w"> </span>create<span class="w"> </span>gs://flux-operator-storage<span class="w"> </span>--project<span class="o">=</span>dinodev<span class="w">  </span>--location<span class="o">=</span>US-CENTRAL1<span class="w"> </span>--uniform-bucket-level-access
</code></pre></div>
</div>
<p>In the above, the storage class defaults to “Standard” Once we’ve created the bucket, let’s go to our snakemake data
and upload the data to it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/tmp/workflow
$<span class="w"> </span>gcloud<span class="w"> </span>storage<span class="w"> </span>cp<span class="w"> </span>--recursive<span class="w"> </span>.<span class="w"> </span>gs://flux-operator-storage/snakemake-workflow/
</code></pre></div>
</div>
<p>You can either view your files in the Google Storage console</p>
<p><img alt="img/google-storage-console.png" src="../_images/google-storage-console.png" /></p>
<p>or view with gcloud again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>storage<span class="w"> </span>ls<span class="w"> </span>gs://flux-operator-storage/snakemake-workflow/
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">gs://flux-operator-storage/snakemake-workflow/.gitpod.yml</span>
<span class="go">gs://flux-operator-storage/snakemake-workflow/Dockerfile</span>
<span class="go">gs://flux-operator-storage/snakemake-workflow/README.md</span>
<span class="go">gs://flux-operator-storage/snakemake-workflow/Snakefile</span>
<span class="go">gs://flux-operator-storage/snakemake-workflow/environment.yaml</span>
<span class="go">gs://flux-operator-storage/snakemake-workflow/data/</span>
<span class="go">gs://flux-operator-storage/snakemake-workflow/scripts/</span>
</code></pre></div>
</div>
<h3 id="install-the-constainer-storage-driver-csi">Install the Constainer Storage Driver (CSI)<a class="headerlink" href="#install-the-constainer-storage-driver-csi" title="Permalink to this heading">¶</a></h3>
<p>There are many <a class="reference external" href="https://kubernetes-csi.github.io/docs/drivers.html">drivers</a> for kubernetes, and we will use
<a class="reference external" href="https://ofek.dev/csi-gcs/getting_started/">this one</a> that requires a stateful set and daemon set to work.
Let’s install those first.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;github.com/ofek/csi-gcs/deploy/overlays/stable?ref=v0.9.0&quot;</span>
$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>CSIDriver,daemonsets,pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>csi
</code></pre></div>
</div>
<p>And to debug:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>csi-gcs<span class="w"> </span>-c<span class="w"> </span>csi-gcs<span class="w"> </span>-n<span class="w"> </span>kube-system
</code></pre></div>
</div>
<p>As you are working, if the mounts seem to work but you don’t see files, keep
in mind you need to be aware of <a class="reference external" href="https://ofek.dev/csi-gcs/dynamic_provisioning/#extra-flags">implicit directories</a>.
The operator will do a <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span></code> on the working directory (and this will show content there) but if you don’t
see content and expect to, you either need to interact in this way or set this flag as an annotation in
your <code class="docutils literal notranslate"><span class="pre">minicluster.yaml</span></code>.</p>
<h3 id="permissions-via-secrets">Permissions via Secrets<a class="headerlink" href="#permissions-via-secrets" title="Permalink to this heading">¶</a></h3>
<p>We will need to give permission for the nodes to access storage, and we can do that via <a class="reference external" href="https://ofek.dev/csi-gcs/dynamic_provisioning/#permission">these instructions</a>
to create a service account key (a json file) from a service account. E.g., I first created a custom service account that
has these permissions:</p>
<p><img alt="img/google-service-account.png" src="../_images/google-service-account.png" /></p>
<p>And then I could find the new identifier in a listing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>iam<span class="w"> </span>service-accounts<span class="w"> </span>list
DISPLAY<span class="w"> </span>NAME<span class="w">                            </span>EMAIL<span class="w">                                               </span>DISABLED
Compute<span class="w"> </span>Engine<span class="w"> </span>default<span class="w"> </span>service<span class="w"> </span>account<span class="w">  </span><span class="m">270958151865</span>-compute@developer.gserviceaccount.com<span class="w">  </span>False
flux-operator-gke<span class="w">                       </span>flux-operator-gke@project.iam.gserviceaccount.com<span class="w">   </span>False
</code></pre></div>
</div>
<p>And create a credential file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>iam<span class="w"> </span>service-accounts<span class="w"> </span>keys<span class="w"> </span>create<span class="w"> </span>&lt;FILE_NAME&gt;.json<span class="w"> </span>--iam-account<span class="w"> </span>&lt;EMAIL&gt;
</code></pre></div>
</div>
<p>And create a secret from it! This is basically giving your cluster permission to interact with a specific bucket.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>csi-gcs-secret<span class="w"> </span>--from-literal<span class="o">=</span><span class="nv">bucket</span><span class="o">=</span>flux-operator-storage<span class="w"> </span>--from-file<span class="o">=</span><span class="nv">key</span><span class="o">=</span>&lt;PATH_TO_SERVICE_ACCOUNT_KEY&gt;
</code></pre></div>
</div>
<h3 id="storage-class">Storage Class<a class="headerlink" href="#storage-class" title="Permalink to this heading">¶</a></h3>
<p>We can then create our storage class, this file is provided in <code class="docutils literal notranslate"><span class="pre">examples/storage/google/storageclass.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">csi-gcs</span>
<span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcs.csi.ofek.dev</span>
</code></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/storageclass.yaml
</code></pre></div>
</div>
<h3 id="snakemake-minicluster">Snakemake MiniCluster<a class="headerlink" href="#snakemake-minicluster" title="Permalink to this heading">¶</a></h3>
<p>The operator can now be run, telling it to use this storage class (named <code class="docutils literal notranslate"><span class="pre">csi-gcs</span></code>) - we provide
an example Minicluster to run this snakemake tutorial to test this out, and note that if you want to debug
you can change the command first to be an ls to see what data is there! Before you apply this file,
make sure that the annotations for storage match your Google project, zone, etc.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1"># Make this kind of persistent volume and claim available to pods</span>
<span class="w">  </span><span class="c1"># This is a type of storage that will use Google Storage</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">data</span><span class="p">:</span>
<span class="w">      </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">csi-gcs</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/data</span>
<span class="w">      </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">csi-gcs-secret</span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">gcs.csi.ofek.dev/location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-central1</span>
<span class="w">        </span><span class="nt">gcs.csi.ofek.dev/project-id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-project</span>
<span class="w">        </span><span class="nt">gcs.csi.ofek.dev/bucket</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-operator-storage</span>
</code></pre></div>
</div>
<p>Also note that we are setting the <code class="docutils literal notranslate"><span class="pre">commands:</span> <span class="pre">-&gt;</span> <span class="pre">runFluxAsRoot</span></code> to true. This isn’t ideal, but it was the
only way I could get the storage to both be seen and have permission to write there. Let’s create the job!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/minicluster.yaml
</code></pre></div>
</div>
<p>Wait to see the certificate generator pod come up, complete, and the worker pods (that depend on it) will finish creation and
then come up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>flux-operator
</code></pre></div>
</div>
<p>And I like to get the main pod and stream the output so I don’t miss it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># Stream to your terminal</span>
$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-sample-0-fj6td<span class="w"> </span>-f

<span class="c1"># Stream to file</span>
$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-sample-0-fj6td<span class="w"> </span>-f<span class="w"> </span>&gt;<span class="w"> </span>output.txt
</code></pre></div>
</div>
<details>
<summary>Snakemake output from Log</summary>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">flux user identifiers:</span>
<span class="go">uid=1000(flux) gid=1000(flux) groups=1000(flux)</span>

<span class="go">As Flux prefix for flux commands: sudo -E PYTHONPATH=/usr/lib/flux/python3.8:/code -E PATH=/opt/micromamba/envs/snakemake/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin -E HOME=/home/flux</span>

<span class="go">👋 Hello, I&#39;m flux-sample-0</span>
<span class="go">The main host is flux-sample-0</span>
<span class="go">The working directory is /workflow/snakemake-workflow, contents include:</span>
<span class="go">Dockerfile  README.md  Snakefile  data  environment.yaml  scripts</span>
<span class="go">End of file listing, if you see nothing above there are no files.</span>
<span class="go">flux R encode --hosts=flux-sample-[0-1]</span>

<span class="go">📦 Resources</span>
<span class="go">{&quot;version&quot;: 1, &quot;execution&quot;: {&quot;R_lite&quot;: [{&quot;rank&quot;: &quot;0-1&quot;, &quot;children&quot;: {&quot;core&quot;: &quot;0&quot;}}], &quot;starttime&quot;: 0.0, &quot;expiration&quot;: 0.0, &quot;nodelist&quot;: [&quot;flux-sample-[0-1]&quot;]}}</span>

<span class="go">🐸 Diagnostics: false</span>

<span class="go">🦊 Independent Minister of Privilege</span>
<span class="go">[exec]</span>
<span class="go">allowed-users = [ &quot;flux&quot;, &quot;root&quot; ]</span>
<span class="go">allowed-shells = [ &quot;/usr/libexec/flux/flux-shell&quot; ]</span>

<span class="go">🐸 Broker Configuration</span>
<span class="gp"># </span>Flux<span class="w"> </span>needs<span class="w"> </span>to<span class="w"> </span>know<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>IMP<span class="w"> </span>executable
<span class="go">[exec]</span>
<span class="go">imp = &quot;/usr/libexec/flux/flux-imp&quot;</span>

<span class="go">[access]</span>
<span class="go">allow-guest-user = true</span>
<span class="go">allow-root-owner = true</span>

<span class="gp"># </span>Point<span class="w"> </span>to<span class="w"> </span>resource<span class="w"> </span>definition<span class="w"> </span>generated<span class="w"> </span>with<span class="w"> </span>flux-R<span class="o">(</span><span class="m">1</span><span class="o">)</span>.
<span class="go">[resource]</span>
<span class="go">path = &quot;/etc/flux/system/R&quot;</span>

<span class="go">[bootstrap]</span>
<span class="go">curve_cert = &quot;/etc/curve/curve.cert&quot;</span>
<span class="go">default_port = 8050</span>
<span class="go">default_bind = &quot;tcp://eth0:%p&quot;</span>
<span class="go">default_connect = &quot;tcp://%h.flux-service.flux-operator.svc.cluster.local:%p&quot;</span>
<span class="go">hosts = [</span>
<span class="go">        { host=&quot;flux-sample-[0-1]&quot;},</span>
<span class="go">]</span>
<span class="gp">#   </span>****<span class="w">  </span>Generated<span class="w"> </span>on<span class="w"> </span><span class="m">2023</span>-02-17<span class="w"> </span><span class="m">21</span>:05:10<span class="w"> </span>by<span class="w"> </span>CZMQ<span class="w">  </span>****
<span class="gp">#   </span>ZeroMQ<span class="w"> </span>CURVE<span class="w"> </span>**Secret**<span class="w"> </span>Certificate
<span class="gp">#   </span>DO<span class="w"> </span>NOT<span class="w"> </span>PROVIDE<span class="w"> </span>THIS<span class="w"> </span>FILE<span class="w"> </span>TO<span class="w"> </span>OTHER<span class="w"> </span>USERS<span class="w"> </span>nor<span class="w"> </span>change<span class="w"> </span>its<span class="w"> </span>permissions.

<span class="go">metadata</span>
<span class="go">    name = &quot;flux-sample-cert-generator&quot;</span>
<span class="go">    time = &quot;2023-02-17T21:05:10&quot;</span>
<span class="go">    userid = &quot;0&quot;</span>
<span class="go">    hostname = &quot;flux-sample-cert-generator&quot;</span>
<span class="go">curve</span>
<span class="go">    public-key = &quot;.!?zfo10Ew)m=+J:j^zehs&amp;{Ayy#BGSV0Eets5Ne&quot;</span>
<span class="go">    secret-key = &quot;vmk%8&amp;dl7ICTfgx?*+0wgPb=@kFA&gt;djvZU-Sl[T6&quot;</span>

<span class="go">🔒️ Working directory permissions:</span>
<span class="go">total 3</span>
<span class="go">-rw-rw-r-- 1 root 63147  233 Feb 10 22:57 Dockerfile</span>
<span class="go">-rw-rw-r-- 1 root 63147  347 Feb 10 22:57 README.md</span>
<span class="go">-rw-rw-r-- 1 root 63147 1144 Feb 10 22:57 Snakefile</span>
<span class="go">drwxrwxr-x 1 root 63147    0 Feb 17 21:05 data</span>
<span class="go">-rw-rw-r-- 1 root 63147  203 Feb 10 22:57 environment.yaml</span>
<span class="go">drwxrwxr-x 1 root 63147    0 Feb 17 21:05 scripts</span>


<span class="go">✨ Curve certificate generated by helper pod</span>
<span class="gp">#   </span>****<span class="w">  </span>Generated<span class="w"> </span>on<span class="w"> </span><span class="m">2023</span>-02-17<span class="w"> </span><span class="m">21</span>:05:10<span class="w"> </span>by<span class="w"> </span>CZMQ<span class="w">  </span>****
<span class="gp">#   </span>ZeroMQ<span class="w"> </span>CURVE<span class="w"> </span>**Secret**<span class="w"> </span>Certificate
<span class="gp">#   </span>DO<span class="w"> </span>NOT<span class="w"> </span>PROVIDE<span class="w"> </span>THIS<span class="w"> </span>FILE<span class="w"> </span>TO<span class="w"> </span>OTHER<span class="w"> </span>USERS<span class="w"> </span>nor<span class="w"> </span>change<span class="w"> </span>its<span class="w"> </span>permissions.

<span class="go">metadata</span>
<span class="go">    name = &quot;flux-sample-cert-generator&quot;</span>
<span class="go">    time = &quot;2023-02-17T21:05:10&quot;</span>
<span class="go">    userid = &quot;0&quot;</span>
<span class="go">    hostname = &quot;flux-sample-cert-generator&quot;</span>
<span class="go">curve</span>
<span class="go">    public-key = &quot;.!?zfo10Ew)m=+J:j^zehs&amp;{Ayy#BGSV0Eets5Ne&quot;</span>
<span class="go">    secret-key = &quot;vmk%8&amp;dl7ICTfgx?*+0wgPb=@kFA&gt;djvZU-Sl[T6&quot;</span>
<span class="go">Extra arguments are: snakemake --cores 1 --flux</span>

<span class="go">🌀 flux start -o --config /etc/flux/config -Scron.directory=/etc/flux/system/cron.d   -Stbon.fanout=256   -Srundir=/run/flux   -Sstatedir=/var/lib/flux   -Slocal-uri=local:///run/flux/local   -Slog-stderr-level=6    -Slog-stderr-mode=local flux mini submit  -n 1 --quiet  --watch snakemake --cores 1 --flux</span>
<span class="go">broker.info[0]: start: none-&gt;join 10.6371ms</span>
<span class="go">broker.info[0]: parent-none: join-&gt;init 0.051043ms</span>
<span class="go">cron.info[0]: synchronizing cron tasks to event heartbeat.pulse</span>
<span class="go">job-manager.info[0]: restart: 0 jobs</span>
<span class="go">job-manager.info[0]: restart: 0 running jobs</span>
<span class="go">job-manager.info[0]: restart: checkpoint.job-manager not found</span>
<span class="go">broker.info[0]: rc1.0: running /etc/flux/rc1.d/01-sched-fluxion</span>
<span class="go">sched-fluxion-resource.warning[0]: create_reader: allowlist unsupported</span>
<span class="go">sched-fluxion-resource.info[0]: populate_resource_db: loaded resources from core&#39;s resource.acquire</span>
<span class="go">broker.info[0]: rc1.0: running /etc/flux/rc1.d/02-cron</span>
<span class="go">broker.info[0]: rc1.0: /etc/flux/rc1 Exited (rc=0) 0.9s</span>
<span class="go">broker.info[0]: rc1-success: init-&gt;quorum 0.922753s</span>
<span class="go">broker.info[0]: online: flux-sample-0 (ranks 0)</span>
<span class="go">broker.info[0]: online: flux-sample-[0-1] (ranks 0-1)</span>
<span class="go">broker.info[0]: quorum-full: quorum-&gt;run 0.427513s</span>
<span class="go">Building DAG of jobs...</span>
<span class="go">Using shell: /usr/bin/bash</span>
<span class="go">Provided cores: 1 (use --cores to define parallelism)</span>
<span class="go">Rules claiming more threads will be scaled down.</span>
<span class="go">Job stats:</span>
<span class="go">job               count    min threads    max threads</span>
<span class="go">--------------  -------  -------------  -------------</span>
<span class="go">all                   1              1              1</span>
<span class="go">bcftools_call         1              1              1</span>
<span class="go">bwa_map               2              1              1</span>
<span class="go">plot_quals            1              1              1</span>
<span class="go">samtools_index        2              1              1</span>
<span class="go">samtools_sort         2              1              1</span>
<span class="go">total                 9              1              1</span>

<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:05:22 2023]</span>
<span class="go">rule bwa_map:</span>
<span class="go">    input: data/genome.fa, data/samples/A.fastq</span>
<span class="go">    output: mapped_reads/A.bam</span>
<span class="go">    jobid: 4</span>
<span class="go">    reason: Missing output files: mapped_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:05:42 2023]</span>
<span class="go">Finished job 4.</span>
<span class="go">1 of 9 steps (11%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:05:43 2023]</span>
<span class="go">rule samtools_sort:</span>
<span class="go">    input: mapped_reads/A.bam</span>
<span class="go">    output: sorted_reads/A.bam</span>
<span class="go">    jobid: 3</span>
<span class="go">    reason: Missing output files: sorted_reads/A.bam; Input files updated by another job: mapped_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:05:52 2023]</span>
<span class="go">Finished job 3.</span>
<span class="go">2 of 9 steps (22%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:05:52 2023]</span>
<span class="go">rule bwa_map:</span>
<span class="go">    input: data/genome.fa, data/samples/B.fastq</span>
<span class="go">    output: mapped_reads/B.bam</span>
<span class="go">    jobid: 6</span>
<span class="go">    reason: Missing output files: mapped_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:02 2023]</span>
<span class="go">Finished job 6.</span>
<span class="go">3 of 9 steps (33%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:02 2023]</span>
<span class="go">rule samtools_sort:</span>
<span class="go">    input: mapped_reads/B.bam</span>
<span class="go">    output: sorted_reads/B.bam</span>
<span class="go">    jobid: 5</span>
<span class="go">    reason: Missing output files: sorted_reads/B.bam; Input files updated by another job: mapped_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:12 2023]</span>
<span class="go">Finished job 5.</span>
<span class="go">4 of 9 steps (44%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:13 2023]</span>
<span class="go">rule samtools_index:</span>
<span class="go">    input: sorted_reads/A.bam</span>
<span class="go">    output: sorted_reads/A.bam.bai</span>
<span class="go">    jobid: 7</span>
<span class="go">    reason: Missing output files: sorted_reads/A.bam.bai; Input files updated by another job: sorted_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:22 2023]</span>
<span class="go">Finished job 7.</span>
<span class="go">5 of 9 steps (56%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:22 2023]</span>
<span class="go">rule samtools_index:</span>
<span class="go">    input: sorted_reads/B.bam</span>
<span class="go">    output: sorted_reads/B.bam.bai</span>
<span class="go">    jobid: 8</span>
<span class="go">    reason: Missing output files: sorted_reads/B.bam.bai; Input files updated by another job: sorted_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:32 2023]</span>
<span class="go">Finished job 8.</span>
<span class="go">6 of 9 steps (67%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:32 2023]</span>
<span class="go">rule bcftools_call:</span>
<span class="go">    input: data/genome.fa, sorted_reads/A.bam, sorted_reads/B.bam, sorted_reads/A.bam.bai, sorted_reads/B.bam.bai</span>
<span class="go">    output: calls/all.vcf</span>
<span class="go">    jobid: 2</span>
<span class="go">    reason: Missing output files: calls/all.vcf; Input files updated by another job: sorted_reads/A.bam, sorted_reads/B.bam, sorted_reads/A.bam.bai, sorted_reads/B.bam.bai</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:43 2023]</span>
<span class="go">Finished job 2.</span>
<span class="go">7 of 9 steps (78%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:43 2023]</span>
<span class="go">rule plot_quals:</span>
<span class="go">    input: calls/all.vcf</span>
<span class="go">    output: plots/quals.svg</span>
<span class="go">    jobid: 1</span>
<span class="go">    reason: Missing output files: plots/quals.svg; Input files updated by another job: calls/all.vcf</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:07:02 2023]</span>
<span class="go">Finished job 1.</span>
<span class="go">8 of 9 steps (89%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:07:02 2023]</span>
<span class="go">localrule all:</span>
<span class="go">    input: plots/quals.svg</span>
<span class="go">    jobid: 0</span>
<span class="go">    reason: Input files updated by another job: plots/quals.svg</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:07:02 2023]</span>
<span class="go">Finished job 0.</span>
<span class="go">9 of 9 steps (100%) done</span>
<span class="go">Complete log: .snakemake/log/2023-02-17T210519.114509.snakemake.log</span>
<span class="go">broker.info[0]: rc2.0: flux mini submit -n 1 --quiet --watch snakemake --cores 1 --flux Exited (rc=0) 115.1s</span>
<span class="go">broker.info[0]: rc2-success: run-&gt;cleanup 1.91796m</span>
<span class="go">broker.info[0]: cleanup.0: flux queue stop --quiet --all --nocheckpoint Exited (rc=0) 0.0s</span>
<span class="go">broker.info[0]: cleanup.1: flux job cancelall --user=all --quiet -f --states RUN Exited (rc=0) 0.0s</span>
<span class="go">broker.info[0]: cleanup.2: flux queue idle --quiet Exited (rc=0) 0.0s</span>
<span class="go">broker.info[0]: cleanup-success: cleanup-&gt;shutdown 49.7479ms</span>
<span class="go">broker.info[0]: children-complete: shutdown-&gt;finalize 93.2169ms</span>
<span class="go">broker.info[0]: rc3.0: running /etc/flux/rc3.d/01-sched-fluxion</span>
<span class="go">broker.info[0]: online: flux-sample-0 (ranks 0)</span>
<span class="go">broker.info[0]: rc3.0: /etc/flux/rc3 Exited (rc=0) 0.2s</span>
<span class="go">broker.info[0]: rc3-success: finalize-&gt;goodbye 0.246792s</span>
<span class="go">broker.info[0]: goodbye: goodbye-&gt;exit 0.080512ms</span>
</code></pre></div>
</div>
</details>
<p>After it finishes the job will cleanup (unless you’ve set <code class="docutils literal notranslate"><span class="pre">cleanup:</span> <span class="pre">false</span></code>) in your minicluster.yaml. If you check
Google storage, you’ll see the output of the run (e.g., data in mapped_reads / mapped_samples /plots) and a “.snakemake”
hidden directory with logs.</p>
<p><img alt="img/snakemake-output.png" src="../_images/snakemake-output.png" /></p>
<p>Note that when this is deployed in a larger scale or a more productions sense, you’ll want to account for
the details (e.g., resource limits) of the storage. This is basically done by (instead of applying the GitHub provided files)
editing them <a class="reference external" href="https://ofek.dev/csi-gcs/getting_started/#resource-requests-limits">via kustomize</a>. Note that I haven’t
tried this yet.</p>
<p><strong>Note</strong>: we would like to get this working without requiring running the workflow as root, but it hasn’t been figured
out yet! If you have insight, please comment on <a class="reference external" href="https://github.com/ofek/csi-gcs/issues/155">this issue</a>.</p>
<h2 id="clean-up">Clean up<a class="headerlink" href="#clean-up" title="Permalink to this heading">¶</a></h2>
<p>Whatever tutorial you choose, don’t forget to clean up at the end!
You can optionally undeploy the operator (this is again at the root of the operator repository clone)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>undeploy
</code></pre></div>
</div>
<p>Or the file you used to deploy it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator.yaml
$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator-dev.yaml
</code></pre></div>
</div>
<p>And then to delete the cluster with gcloud:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>delete<span class="w"> </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>flux-cluster
</code></pre></div>
</div>
<p>I like to check in the cloud console to ensure that it was actually deleted.</p>
<h2 id="customization-and-debugging">Customization and Debugging<a class="headerlink" href="#customization-and-debugging" title="Permalink to this heading">¶</a></h2>
<h3 id="firewall">Firewall<a class="headerlink" href="#firewall" title="Permalink to this heading">¶</a></h3>
<p>When I first created my cluster, the nodes could not see one another. I added a few
flags for networking, and looked at firewalls as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>describe<span class="w"> </span>flux-cluster<span class="w"> </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>clusterIpv4Cidr
</code></pre></div>
</div>
<p>I didn’t ultimately change anything, but I found this useful.</p>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Mar 07, 2023
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="aws.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Amazon Web Services" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Amazon Web Services
            </div>
          </div>
        </a>
      
      
        
        <a href="../about/index.html" class="md-footer__link md-footer__link--next" aria-label="Next: About the Flux Operator" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              About the Flux Operator
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2022-2023, Flux Developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    6.1.3.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/flux-framework/flux-operator" target="_blank" rel="noopener" title="Flux Operator on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://flux-framework.org/" target="_blank" rel="noopener" title="Flux Framework" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 2.05c5.05.5 9 4.77 9 9.95 0 1.45-.32 2.83-.88 4.07l-2.62-1.53c.32-.79.5-1.64.5-2.54 0-3.53-2.61-6.43-6-6.92V2.05M12 19c2.21 0 4.17-1 5.45-2.62l2.6 1.53A9.97 9.97 0 0 1 12 22C6.47 22 2 17.5 2 12a9.99 9.99 0 0 1 9-9.95v3.03C7.61 5.57 5 8.47 5 12a7 7 0 0 0 7 7m0-13a6 6 0 0 1 6 6c0 2.97-2.16 5.44-5 5.92v-3.09c1.17-.41 2-1.52 2-2.83a3 3 0 0 0-3-3l-.55.05-1.54-2.67C10.56 6.13 11.26 6 12 6m-6 6c0-1.86.85-3.5 2.18-4.62l1.54 2.67C9.27 10.57 9 11.26 9 12c0 1.31.83 2.42 2 2.83v3.09c-2.84-.48-5-2.95-5-5.92Z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.tabs", "toc.integrate", "navigation.sections", "navigation.instant", "header.autohide", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "toc.follow", "toc.sticky", "content.tabs.link", "announce.dismiss"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../_static/sphinx_immaterial_theme.cea6a0c1d5b0618cf.min.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>